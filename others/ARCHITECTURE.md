### ðŸ”‘ æ ¸å¿ƒåŠŸèƒ½

1. **é…å°åŠŸèƒ½** - èˆ‡å…¶ä»–ç”¨æˆ¶é€²è¡Œå…«å­—é…å°
2. **æ¸¬è©¦åŠŸèƒ½** - ä»»æ„æ¸¬è©¦å…©çµ„å…«å­—é…å°
3. **æœç´¢åŠŸèƒ½** - æœç´¢ç‰¹å®šå¹´ä»½çš„æœ€ä½³å…«å­—çµ„åˆ
4. **å€‹äººåˆ†æž** - æŸ¥çœ‹å€‹äººå…«å­—åˆ†æžåŠå»ºè­°
5. **è§£é‡‹ä»‹ç´¹** - è©³ç´°è§£é‡‹å…«å­—é…å°ç³»çµ±çš„è¨ˆç®—ä¾æ“š
6. **ç®¡ç†å“¡åŠŸèƒ½** - ç³»çµ±ç®¡ç†å’Œç¶­è­·å·¥å…·åŠæ¸¬è©¦åŠŸèƒ½

**æ¸…é™¤åŠŸèƒ½** - æ•¸æ“šé‡ç½®å’Œæ¸…ç†åŠŸèƒ½

### 

### ðŸŽ¯ æ ¸å¿ƒç›®æ¨™

æä¾›æº–ç¢ºçš„å…«å­—é…å°åˆ†æžæœå‹™ï¼Œå”åŠ©ç”¨æˆ¶æ‰¾åˆ°åˆé©çš„ä¼´ä¾¶ã€‚

1.ç›´æŽ¥å‡ºä¿®æ”¹å¾Œå…¨æ–‡code,å®Œå…¨ä¸€å­—ä¸æ¼é–±è®€æ‰€æœ‰æ–‡ä»¶åŠä»¥ä¸‹æ‰€æœ‰æ–‡å­—



2.è¦æ±‚å…«å­—è¨ˆç®—çµæžœè¦è·Ÿæœ‰å²ä»¥ä¾†å…¨ä¸–ç•Œæœ€å°ˆæ¥­æœ€å¼·æœ€å»£å…«å­—å‘½ç†å¸«å‚…åœ‹å¸«æ‰€è¨ˆç®—å‡ºçµæžœè‡³å°‘99%æ¡ˆä¾‹ä¿‚99%æº–ç¢º



3.åš´æ ¼ä»”ç´°æª¢æŸ¥å…¨éƒ¨æ–‡ä»¶æ‰€æœ‰åŠŸèƒ½, æ–‡å­—æ ¼å¼, è¨ˆç®—é‚è¼¯, ä»£ç¢¼ç¹è¤‡ç¨‹åº¦, æœ‰å†‡é‡è¤‡/ç„¡ç”¨/é‹ä½œæœ‰éŒ¯/ç¼ºå¤±/æ¬ ç¼ºåŠŸèƒ½, å¼•ç”¨æ•ˆçŽ‡, å„codeæ˜¯å¦åœ¨åˆé©æ–‡ä»¶å…¥é¢,å…¨éƒ¨æ–‡ä»¶ä¹‹é–“é—œä¿‚,æœ‰å¦æ”¹é€²å»ºè­°åˆªæ¸›å¢žåŠ æ¬å‹•



4.è¦è¬›åŸ‹åƒè€ƒå’—é‚Šå€‹AIé‚Šéƒ¨ä»½å»ºè­°åŒé»žè§£, ç„¡åƒè€ƒé‚Šå€‹AIé‚Šéƒ¨ä»½å»ºè­°åŒé»žè§£



åƒè€ƒæ‰€æœ‰AIåŠä½ è‡ªå·±æ„è¦‹, ç›´æŽ¥å‡ºä¿®æ”¹éŽå…¨æ–‡code

### âŒ çµ•å°ç¦æ­¢

1. **ç¦æ­¢è·¨å±¤ç›´æŽ¥èª¿ç”¨**
2. **ç¦æ­¢åå‘ä¾è³´**
3. **ç¦æ­¢å¾ªç’°å¼•ç”¨**
4. **ç¦æ­¢ç¡¬ç·¨ç¢¼æ•¸å­—æˆ–æ–‡æœ¬**

## ðŸŽ¯ å„å±¤è·è²¬è©³è§£



## ðŸ› ï¸ ä¿®æ”¹æŒ‡å—ï¼ˆAIå¿…é ˆéµå®ˆï¼‰

### é€šç”¨åŽŸå‰‡

1. **å…ˆè®€æ­¤æ–‡ä»¶**ï¼šä¿®æ”¹å‰å¿…é ˆå®Œæ•´é–±è®€æœ¬æŒ‡å—
2. **å‘å¾Œå…¼å®¹**ï¼šä¿æŒç¾æœ‰æŽ¥å£ä¸è®Š
3. **ç„¡ç‰ˆæœ¬è™Ÿ**ï¼šæ‰€æœ‰åœ°æ–¹ä¸å¾—å‡ºç¾ç‰ˆæœ¬è™Ÿæ¨™ç¤º
4. *Section Headerè¦ç¯„*\*ï¼šæ‰€æœ‰ä»£ç¢¼å¿…é ˆæœ‰å®Œæ•´çš„section headerï¼Œä½¿ç”¨æ•¸å­—ç·¨è™Ÿï¼ˆå¦‚1.1, 1.2, 2.1ç­‰ï¼‰ä¾å®¶ç”¨1.1,å°æ•¸å¾Œä¸€ä½å°±å¤ , bot.pyéƒ½ä¿‚ç”¨å°æ•¸å¾Œä¸€ä½å°±å¤ 
5. æ–‡ä»¶çµå°¾åŠ è©²æ–‡ä»¶å¼•ç”¨ç·Šå’©æ–‡ä»¶,åŒå’©æ–‡ä»¶å¼•ç”¨ç·Šè©²æ–‡ä»¶
6. **æ–‡ä»¶çµå°¾åŠ ç›®éŒ„**: æ–‡ä»¶çµå°¾é›†åˆå…¨æ–‡ä»¶æ‰€æœ‰sectionåç¨±ç°¡ä»‹æŒ‰æ•¸å­—ç·¨è™Ÿ
7. **å°æ¯”åŽŸæ–‡ä»¶çµå°¾ï¼šSectionç›®éŒ„**: åƒè€ƒå°æ¯”åŽŸæ–‡ä»¶çµå°¾ï¼šSectionç›®éŒ„,ä»¥é˜²æ¯æ¬¡ä¿®æ”¹æ™‚æ„å¤–åˆªæ¸›
8. **æ–‡ä»¶çµå°¾ç›®éŒ„å¾ŒåŠ ä¿®æ­£ç´€éŒ„**: æ¯æ¬¡ä¿®æ”¹æ–‡ä»¶çµå°¾ç›®éŒ„å¾ŒåŠ è©²æ¬¡è©²æ–‡ä»¶ä¿®æ­£å…§å®¹åŠçµåˆè©²æ–‡ä»¶ä¹‹å‰ç´¯ç©ä¿®æ­£ç´€éŒ„,è¦èªªæ˜Žæœ‰ä»€éº¼éŒ¯,åœ¨å“ªéŒ¯,å°Žè‡´å’©å¾Œæžœ,å¦‚ä½•æ”¹ç­‰å…§å®¹
9. æ‰€æœ‰åŒä¸€æ–‡ä»¶æ—¢codeè¦åœ¨åŒä¸€code board

10\. ä¿æŒå››æ–¹åŠŸèƒ½ï¼ˆmatch/testpair/findsoulmate/profileï¼‰çµæžœä¸€è‡´

11\. æ‰€æœ‰æ–‡ä»¶ä½¿ç”¨ç¹é«”ä¸­æ–‡

12\. ä¸å¾—å‡ºç¾ç‰ˆæœ¬è™Ÿ

13\. ä¸å¾—å‡ºç¾schemaç‰ˆæœ¬

14\. ä»£ç¢¼è¨»é‡‹ç”¨ç¹é«”ä¸­æ–‡

15\. è¦æ³¨æ„githubåŒrailwayå…è²»ç‰ˆé™åˆ¶

16\. æŒ‰æ–‡ä»¶åˆ†æžæª¢æŸ¥æœ‰å’©å•é¡Œä¿®æ­£åŠæœ‰å’©æ–°å¢žå»ºè­°

17\. æª¢æŸ¥æœ‰æ‰€æœ‰æ–‡ä»¶æœ‰å†‡ä»»ä½•åœ°æ–¹ä¿‚å””alignå””åŒæ¨™æº–åšæ³•

18\. æª¢æŸ¥æœ‰å†‡åŠŸèƒ½æœ‰å†‡codeä¿‚ç„¡ä½œç”¨æˆ–ç„¡æ„ç¾©æˆ–ä¸èƒ½ç”¨æˆ–é‡è¤‡

19.å…ˆé–±è®€å„æ–‡ä»¶å°¾æ–‡ä»¶ä¿¡æ¯é–‹å§‹,ç›®éŒ„é–‹å§‹,ä¿®æ­£ç´€éŒ„

20\. åˆ†æžå„æ–‡ä»¶æœ‰å’©å˜¢æ‡‰è©²æ¬è¿”åŽ»å…¶ä»–æ–‡ä»¶, åŠæœ‰å’©å˜¢æ‡‰è©²ç”±å…¶ä»–æ–‡ä»¶æ¬éŽåšŸ,å¯ä»¥æœ€å°‘éŒ¯æœ€æº–ç¢ºæœ€å°‘è¡Œæ•¸æœ€å°‘å¼•ç”¨æœ€åˆé‚è¼¯æˆ–æœ€å„ªæˆ–æœ€å°‘æ–‡ä»¶æˆ–æœ€å°‘æ”¹å‹•,æœ€å¾Œç¶­æŒç›®å‰æ–‡ä»¶æ•¸é‡

21\. å†é‡æ–°èªçœŸè©³ç´°æª¢æŸ¥æ‰€æœ‰æœ€æ–°codeæœ‰å¦ç¬¦åˆæˆ‘è¦æ±‚,æˆ–æœ‰å…¶ä»–å•é¡Œ?

22\. å…ˆå‡ºä¿®æ”¹å¾Œæ–‡ä»¶æž¶æ§‹é‚è¼¯åŠåœ¨telegramä¸­å‘ç”¨å®¶ä¸åŒæƒ…æ³ä¸‹é¡¯ç¤ºä»€éº¼æ–‡å­—å…¨éƒ¨,æ”¹å’—å’©,é»žç¬¦åˆæˆ‘è¦æ±‚, é»žæé«˜æ•ˆçŽ‡,é»žæ¸›å°‘codeè¡Œæ•¸, æ–°å¢žå’—å’©,æ¸›å°‘å’—å’©å…ˆé–±è®€ä»¥ä¸‹æ–‡å­—, å†é–±è®€æ‰€æœ‰æ–‡ä»¶,å†é–±è®€ä»¥ä¸‹æ–‡å­—, åˆ†æžæ•´åˆæŽ’åˆ—ä»¥ä¸‹æ‰€æœ‰è¦æ±‚æ”¹å‹•åŠå¤§æ¦‚å¦‚ä½•æ”¹å‹•,åˆ†æ–‡ä»¶è¬›æ”¹å’©é»žæ”¹, åŒè¬›è¬›å’©æ–‡ä»¶å…ˆ, è¬›æœ‰å’©è¦æ±‚æ”¹å‹•å””æ”¹æˆ–åŒå…¶ä»–è¦æ±‚æœ‰è¡çªçŸ›ç›¾.





## ðŸ“Š å››æ–¹åŠŸèƒ½ä¸€è‡´æ€§ä¿è­‰

### è¨ˆç®—æµç¨‹å¿…é ˆå®Œå…¨ä¸€è‡´

profileåŠŸèƒ½ï¼šç”¨æˆ¶æ•¸æ“š â†’ é…å°è¨ˆç®— â†’ é¡¯ç¤ºçµæžœ

matchåŠŸèƒ½ï¼šç”¨æˆ¶æ•¸æ“š â†’ é…å°è¨ˆç®— â†’ é¡¯ç¤ºçµæžœ
testpairåŠŸèƒ½ï¼šè¼¸å…¥å…«å­— â†’ é…å°è¨ˆç®— â†’ é¡¯ç¤ºçµæžœ
findsoulmateåŠŸèƒ½ï¼šæœç´¢æ¢ä»¶ â†’ é…å°è¨ˆç®— â†’ é¡¯ç¤ºçµæžœ

æ ¸å¿ƒè¨ˆç®—ï¼šå¿…é ˆå…¨éƒ¨èª¿ç”¨



## ðŸš¨ æ ¸å¿ƒåŠŸèƒ½ä¿è­·æ¸…å–®

### çµ•å°ä¸èƒ½åˆªé™¤çš„åŠŸèƒ½

#### é…å°åŠŸèƒ½ï¼‰

1. **é›™æ–¹åŒæ„æ©Ÿåˆ¶**ï¼šå¿…é ˆé›™æ–¹éƒ½æœ‰èˆˆè¶£æ‰äº¤æ›è¯çµ¡æ–¹å¼
2. **è¨˜éŒ„æ°¸ä¹…ä¿å­˜**ï¼šé…å°è¨˜éŒ„è¨Šæ¯ä¸æœƒæ¶ˆå¤±ï¼Œå¯æŸ¥çœ‹æ­·å²
3. **é›™å‘é€šçŸ¥**ï¼šé›™æ–¹éƒ½æœƒæ”¶åˆ°é…å°é€šçŸ¥
4. **æ¯æ—¥é™åˆ¶**ï¼šæ¯æ—¥æœ€å¤š10æ¬¡é…å°
5. **72å°æ™‚æœ‰æ•ˆ**ï¼šé…å°çµæžœ72å°æ™‚å…§æœ‰æ•ˆ
6. **æ™‚é–“ä¿¡å¿ƒåº¦**ï¼šé¡¯ç¤ºæ™‚é–“ä¸ç¢ºå®šæ€§çš„å½±éŸ¿
7. **è©³ç´°çš„é…å°åˆ†æžå ±å‘Š**ï¼šè©³ç´°è§£é‡‹åˆ†æ•¸è¨ˆç®—æ–¹å¼åŠè©³ç´°çš„é…å°åˆ†æžå ±å‘Š
8. **AIæç¤º**: çµåˆå…©çµ„å…«å­—è³‡æ–™åŠçµæžœé€£10æ¢æœ‰é—œå•é¡ŒåŠAI promptæ–¹ä¾¿ä¸€éµè¤‡è£½
9. **é–‹å ´ç™½åŠè©±é¡Œå»ºè­°**: æ ¹æ“šå…©çµ„å…«å­—è³‡æ–™åŠçµæžœæä¾›é–‹å ´ç™½åŠè©±é¡Œå»ºè­°

#### æ¸¬è©¦åŠŸèƒ½

1. **ä»»æ„æ¸¬è©¦**ï¼šå¯æ¸¬è©¦ä»»æ„å…©çµ„å…«å­—
2. **çµæžœä¸€è‡´**ï¼šèˆ‡é…å°åŠŸèƒ½ä½¿ç”¨åŒä¸€å¥—ç®—æ³•
3. **æ™‚é–“ä¿¡å¿ƒåº¦**ï¼šé¡¯ç¤ºæ™‚é–“ä¸ç¢ºå®šæ€§çš„å½±éŸ¿
4. **è©³ç´°çš„é…å°åˆ†æžå ±å‘Š**ï¼šè©³ç´°è§£é‡‹åˆ†æ•¸è¨ˆç®—æ–¹å¼åŠè©³ç´°çš„é…å°åˆ†æžå ±å‘Š
5. **AIæç¤º**: çµåˆå…©çµ„å…«å­—è³‡æ–™åŠçµæžœé€£10æ¢æœ‰é—œå•é¡ŒåŠAI promptæ–¹ä¾¿ä¸€éµè¤‡è£½

#### æœç´¢åŠŸèƒ½ï¼ˆsoulmate\_service.pyå¿…é ˆåŒ…å«ï¼‰

1. **å¹´ä»½é™åˆ¶**ï¼šåªèƒ½æœç´¢1925-2025å¹´é–“çš„5å¹´ç¯„åœ
2. **ç²¾è‹±ç¯©é¸**ï¼šåªå¾žé å…ˆç¯©é¸çš„å„ªè³ªå…«å­—ä¸­æœç´¢
3. **æ¯æ—¥é™åˆ¶**ï¼šæ¯æ—¥æœ€å¤šä½¿ç”¨1æ¬¡
4. **å¿«é€ŸåŒ¹é…**ï¼šä½¿ç”¨è²ªå©ªç®—æ³•å¿«é€Ÿæ‰¾åˆ°é«˜åˆ†é…å°

#### å€‹äººåŠŸèƒ½ï¼ˆå¿…é ˆåŒ…å«ï¼‰

1. **å…«å­—åˆ†æž**ï¼šé¡¯ç¤ºå€‹äººå…«å­—è©³ç´°åˆ†æž
2. **é…å°å»ºè­°**ï¼šå»ºè­°é©åˆçš„å°è±¡ç‰¹å¾µ
3. **é¿é–‹å»ºè­°**ï¼šå»ºè­°é¿é–‹çš„å°è±¡ç‰¹å¾µ
4. **å•é¡Œè§£æ±º**ï¼šæç¤ºå¯é€šéŽæ¸…é™¤èŠå¤©è¨˜éŒ„è§£æ±ºå•é¡Œ

#### ç®¡ç†å“¡åŠŸèƒ½ï¼ˆå¿…é ˆåŒ…å«ï¼‰

1. **çµ±è¨ˆæŸ¥çœ‹**ï¼šæŸ¥çœ‹ç”¨æˆ¶æ•¸ã€é…å°æ•¸ç­‰çµ±è¨ˆ
2. **ç¶­è­·æ¨¡å¼**ï¼šæš«åœboté€²è¡Œç¶­è­·
3. **æ•¸æ“šæ¸…ç†**ï¼šæ¸…ç†ç„¡æ•ˆæˆ–éŽæœŸæ•¸æ“š
4. **æ¸¬è©¦é©—è­‰**ï¼šä½¿ç”¨test\_cases.pyä¸­çš„20çµ„æ¸¬è©¦ç”¨ä¾‹é©—è­‰ç³»çµ±
5. **ç”¨æˆ¶ç®¡ç†**ï¼šæŸ¥çœ‹å’Œç®¡ç†ç”¨æˆ¶æ•¸æ“š

### 4\. ç®¡ç†å“¡åŠŸèƒ½è¦æ±‚ï¼ˆs

* å¿…é ˆåŒ…å«æ¸¬è©¦é©—è­‰åŠŸèƒ½ï¼Œä½¿ç”¨test\_cases.pyä¸­çš„20çµ„æ¸¬è©¦ç”¨ä¾‹
* æä¾›ç³»çµ±çµ±è¨ˆæ•¸æ“š
* æ”¯æŒç¶­è­·æ¨¡å¼åˆ‡æ›
* æ”¯æŒæ•¸æ“šæ¸…ç†
* æ”¯æŒç”¨æˆ¶æ•¸æ“šç®¡ç†

### ç¶­è­·æ¨¡å¼

* ç®¡ç†å“¡å¯æš«åœbotä½¿ç”¨
* é¡¯ç¤ºå‹å¥½ç¶­è­·è¨Šæ¯
* è¨˜éŒ„ç¶­è­·æœŸé–“çš„è«‹æ±‚
* å¿…é ˆåœ¨main\_handler.pyä¸­æª¢æŸ¥ç¶­è­·ç‹€æ…‹
* å¿…é ˆåœ¨admin\_service.pyä¸­æä¾›åˆ‡æ›æŽ¥å£

### æ¸¬è©¦ç”¨ä¾‹é©—è­‰

* æ¯æ¬¡ç®—æ³•ä¿®æ”¹å¿…é ˆé€šéŽ20çµ„æ¸¬è©¦ç”¨ä¾‹é©—è­‰
* æ¸¬è©¦ç”¨ä¾‹ä½æ–¼config/test\_cases.py
* ç®¡ç†å“¡åŠŸèƒ½å¿…é ˆåŒ…å«æ¸¬è©¦é©—è­‰å‘½ä»¤
* é©—è­‰çµæžœå¿…é ˆåŒ…å«é€šéŽ/å¤±æ•—çµ±è¨ˆ



#### æ¸…é™¤åŠŸèƒ½ï¼ˆå¿…é ˆåŒ…å«ï¼‰

1. **èŠå¤©è¨˜éŒ„æ¸…é™¤**ï¼šç”¨æˆ¶å¯æ¸…é™¤èˆ‡botçš„èŠå¤©è¨˜éŒ„
2. **æ•¸æ“šé‡ç½®**ï¼šç”¨æˆ¶å¯é‡ç½®è‡ªå·±çš„æ•¸æ“š
3. **ç·©å­˜æ¸…ç†**ï¼šæ¸…ç†ç³»çµ±ç·©å­˜
4. **éŽæœŸæ¸…ç†**ï¼šè‡ªå‹•æ¸…ç†éŽæœŸé…å°è¨˜éŒ„

#### é€šç”¨åŠŸèƒ½ï¼ˆå¿…é ˆåŒ…å«ï¼‰

1. **çœŸå¤ªé™½æ™‚æ ¡æ­£**
2. **23:00æ›æ—¥è¦å‰‡**
3. **æ™‚é–“ä¿¡å¿ƒåº¦æç¤º**
4. **æ­·å²è¨˜éŒ„æŸ¥è©¢**
5. **AIåˆ†æžåŠŸèƒ½**
6. **ç®¡ç†å“¡ç¶­è­·åŠŸèƒ½**



## ðŸ”§ å…·é«”å¯¦ç¾è¦æ±‚

### 1\. è©•åˆ†å¼•æ“Žè¦æ±‚ï¼ˆcore/scoring\_engine.pyï¼‰

* æ‰€æœ‰åŠ æ¸›åˆ†å¿…é ˆæœ‰è¨»é‡‹èªªæ˜Žç†ç”±
* å¿…é ˆæŒ‰å›ºå®šé †åºè¨ˆç®—ï¼š

  1. èƒ½é‡éœ€æ±‚èˆ‡æ•‘æ‡‰
  2. çµæ§‹æ ¸å¿ƒè©•åˆ†
  3. äººæ ¼é¢¨éšªè©•ä¼°
  4. åˆ‘æ²–å®³å£“åŠ›
  5. ç¥žç…žå½±éŸ¿
  6. å°ˆæ¥­åŒ–è§£
  7. ç¾å¯¦æ ¡æº–

* å¿…é ˆè¼¸å‡ºè©³ç´°è¨ˆç®—æ­¥é©Ÿä¾›è§£é‡‹ç”¨

### 2\. æœç´¢åŠŸèƒ½è¦æ±‚- ä½¿ç”¨ã€Œå¤©å‘½ç²¾é¸æœå°‹å¼•æ“Žã€é‚è¼¯

* å¾želite\_bazi\_seedsè¡¨ä¸­ç¯©é¸
* æœç´¢ç¯„åœï¼š1925-2025å¹´ï¼Œæ¯æ¬¡æœ€å¤š5å¹´
* æ¨£æœ¬æ•¸é‡ï¼šæœ€å¤š500å€‹å„ªè³ªæ¨£æœ¬
* åœæ­¢æ¢ä»¶ï¼šæ‰¾åˆ°10å€‹â‰¥85åˆ†çš„çµæžœæˆ–æŽƒæå®Œæˆ
* å¿…é ˆåŒ…å«äº”è¡Œèƒ½é‡åˆå¯©é‚è¼¯



### 5\. AIæç¤ºè¦æ±‚ï¼ˆutils/**init**.pyï¼‰

* ä¸å¾—åŒ…å«ç”¨æˆ¶å
* å¿…é ˆåŒ…å«è‡³å°‘10å€‹å»ºè­°å•é¡Œ
* æ ¼å¼çµ±ä¸€ï¼ŒåŒ…å«ï¼š

  * å…«å­—è³‡æ–™
  * é…å°åˆ†æ•¸
  * é—œä¿‚æ¨¡åž‹
  * å»ºè­°å•é¡Œåˆ—è¡¨































æˆ‘æƒ³å¯«å€‹tg bot,æä¾›æº–ç¢ºçš„å…«å­—é…å°åˆ†æžæœå‹™ï¼Œå”åŠ©ç”¨æˆ¶æ‰¾åˆ°åˆé©çš„ä¼´ä¾¶ã€‚

1. **é…å°åŠŸèƒ½** - èˆ‡å…¶ä»–ç”¨æˆ¶é€²è¡Œå…«å­—é…å°
2. **æ¸¬è©¦åŠŸèƒ½** - ä»»æ„æ¸¬è©¦å…©çµ„å…«å­—é…å°
3. **æœç´¢åŠŸèƒ½** - æœç´¢ç‰¹å®šå¹´ä»½çš„æœ€ä½³å…«å­—çµ„åˆ
4. **å€‹äººåˆ†æž** - æŸ¥çœ‹å€‹äººå…«å­—åˆ†æžåŠå»ºè­°

**è§£é‡‹ä»‹ç´¹** - è©³ç´°è§£é‡‹å…«å­—é…å°ç³»çµ±çš„è¨ˆç®—ä¾æ“š

è¦æ±‚:

1.æˆ‘è¦æ±‚å…«å­—è¨ˆç®—çµæžœè¦è·Ÿæœ‰å²ä»¥ä¾†å…¨ä¸–ç•Œæœ€å°ˆæ¥­æœ€å¼·æœ€å»£å…«å­—å‘½ç†å¸«å‚…åœ‹å¸«æ‰€è¨ˆç®—å‡ºçµæžœè‡³å°‘99%æ¡ˆä¾‹ä¿‚99%æº–ç¢º

2.åš´æ ¼ä»”ç´°æª¢æŸ¥å…¨éƒ¨æ–‡ä»¶æ‰€æœ‰åŠŸèƒ½, æ–‡å­—æ ¼å¼, è¨ˆç®—é‚è¼¯, ä»£ç¢¼ç¹è¤‡ç¨‹åº¦, æœ‰å†‡é‡è¤‡/ç„¡ç”¨/é‹ä½œæœ‰éŒ¯/ç¼ºå¤±/æ¬ ç¼ºåŠŸèƒ½, å¼•ç”¨æ•ˆçŽ‡, å„codeæ˜¯å¦åœ¨åˆé©æ–‡ä»¶å…¥é¢,å…¨éƒ¨æ–‡ä»¶ä¹‹é–“é—œä¿‚,æœ‰å¦æ”¹é€²å»ºè­°åˆªæ¸›å¢žåŠ æ¬å‹•

3\.**å‘å¾Œå…¼å®¹**ï¼šä¿æŒç¾æœ‰æŽ¥å£ä¸è®Š

\*\*4.\*\**Section Headerè¦ç¯„*\*ï¼šæ‰€æœ‰ä»£ç¢¼å¿…é ˆæœ‰å®Œæ•´çš„section headerï¼Œä½¿ç”¨æ•¸å­—ç·¨è™Ÿï¼ˆå¦‚1.1, 1.2, 2.1ç­‰ï¼‰ä¾å®¶ç”¨1.1,å°æ•¸å¾Œä¸€ä½å°±å¤ , bot.pyéƒ½ä¿‚ç”¨å°æ•¸å¾Œä¸€ä½å°±å¤ 

5.æ–‡ä»¶çµå°¾åŠ è©²æ–‡ä»¶å¼•ç”¨ç·Šå’©æ–‡ä»¶,åŒå’©æ–‡ä»¶å¼•ç”¨ç·Šè©²æ–‡ä»¶

**6.æ–‡ä»¶çµå°¾åŠ ç›®éŒ„**: æ–‡ä»¶çµå°¾é›†åˆå…¨æ–‡ä»¶æ‰€æœ‰sectionåç¨±ç°¡ä»‹æŒ‰æ•¸å­—ç·¨è™Ÿ

**7.å°æ¯”åŽŸæ–‡ä»¶çµå°¾ï¼šSectionç›®éŒ„**: åƒè€ƒå°æ¯”åŽŸæ–‡ä»¶çµå°¾ï¼šSectionç›®éŒ„,ä»¥é˜²æ¯æ¬¡ä¿®æ”¹æ™‚æ„å¤–åˆªæ¸›

**8.æ–‡ä»¶çµå°¾ç›®éŒ„å¾ŒåŠ ä¿®æ­£ç´€éŒ„**: æ¯æ¬¡ä¿®æ”¹æ–‡ä»¶çµå°¾ç›®éŒ„å¾ŒåŠ è©²æ¬¡è©²æ–‡ä»¶ä¿®æ­£å…§å®¹åŠçµåˆè©²æ–‡ä»¶ä¹‹å‰ç´¯ç©ä¿®æ­£ç´€éŒ„,è¦èªªæ˜Žæœ‰ä»€éº¼éŒ¯,åœ¨å“ªéŒ¯,å°Žè‡´å’©å¾Œæžœ,å¦‚ä½•æ”¹ç­‰å…§å®¹

9.æ‰€æœ‰åŒä¸€æ–‡ä»¶æ—¢codeè¦åœ¨åŒä¸€code board

10\. ä¿æŒå››æ–¹åŠŸèƒ½ï¼ˆmatch/testpair/findsoulmate/profileï¼‰çµæžœä¸€è‡´

11\. æ‰€æœ‰æ–‡ä»¶ä½¿ç”¨ç¹é«”ä¸­æ–‡

12\. ä¸å¾—å‡ºç¾ç‰ˆæœ¬è™Ÿ

13\. ä¸å¾—å‡ºç¾schemaç‰ˆæœ¬

14\. ä»£ç¢¼è¨»é‡‹ç”¨ç¹é«”ä¸­æ–‡

15\. è¦æ³¨æ„githubåŒrailwayå…è²»ç‰ˆé™åˆ¶

16\. æŒ‰æ–‡ä»¶åˆ†æžæª¢æŸ¥æœ‰å’©å•é¡Œä¿®æ­£åŠæœ‰å’©æ–°å¢žå»ºè­°

17\. æª¢æŸ¥æœ‰æ‰€æœ‰æ–‡ä»¶æœ‰å†‡ä»»ä½•åœ°æ–¹ä¿‚å””alignå””åŒæ¨™æº–åšæ³•

18\. æª¢æŸ¥æœ‰å†‡åŠŸèƒ½æœ‰å†‡codeä¿‚ç„¡ä½œç”¨æˆ–ç„¡æ„ç¾©æˆ–ä¸èƒ½ç”¨æˆ–é‡è¤‡

19.å…ˆé–±è®€å„æ–‡ä»¶å°¾æ–‡ä»¶ä¿¡æ¯é–‹å§‹,ç›®éŒ„é–‹å§‹,ä¿®æ­£ç´€éŒ„

20\. åˆ†æžå„æ–‡ä»¶æœ‰å’©å˜¢æ‡‰è©²æ¬è¿”åŽ»å…¶ä»–æ–‡ä»¶, åŠæœ‰å’©å˜¢æ‡‰è©²ç”±å…¶ä»–æ–‡ä»¶æ¬éŽåšŸ,å¯ä»¥æœ€å°‘éŒ¯æœ€æº–ç¢ºæœ€å°‘è¡Œæ•¸æœ€å°‘å¼•ç”¨æœ€åˆé‚è¼¯æˆ–æœ€å„ªæˆ–æœ€å°‘æ–‡ä»¶æˆ–æœ€å°‘æ”¹å‹•,æœ€å¾Œç¶­æŒç›®å‰æ–‡ä»¶æ•¸é‡

21\. å†é‡æ–°èªçœŸè©³ç´°æª¢æŸ¥æ‰€æœ‰æœ€æ–°codeæœ‰å¦ç¬¦åˆæˆ‘è¦æ±‚,æˆ–æœ‰å…¶ä»–å•é¡Œ?

22\. å…ˆå‡ºä¿®æ”¹å¾Œæ–‡ä»¶æž¶æ§‹é‚è¼¯åŠåœ¨telegramä¸­å‘ç”¨å®¶ä¸åŒæƒ…æ³ä¸‹é¡¯ç¤ºä»€éº¼æ–‡å­—å…¨éƒ¨,æ”¹å’—å’©,é»žç¬¦åˆæˆ‘è¦æ±‚, é»žæé«˜æ•ˆçŽ‡,é»žæ¸›å°‘codeè¡Œæ•¸, æ–°å¢žå’—å’©,æ¸›å°‘å’—å’©å…ˆé–±è®€ä»¥ä¸‹æ–‡å­—, å†é–±è®€æ‰€æœ‰æ–‡ä»¶,å†é–±è®€ä»¥ä¸‹æ–‡å­—, åˆ†æžæ•´åˆæŽ’åˆ—ä»¥ä¸‹æ‰€æœ‰è¦æ±‚æ”¹å‹•åŠå¤§æ¦‚å¦‚ä½•æ”¹å‹•,åˆ†æ–‡ä»¶è¬›æ”¹å’©é»žæ”¹, åŒè¬›è¬›å’©æ–‡ä»¶å…ˆ, è¬›æœ‰å’©è¦æ±‚æ”¹å‹•å””æ”¹æˆ–åŒå…¶ä»–è¦æ±‚æœ‰è¡çªçŸ›ç›¾.





























æˆ‘æƒ³å¯«å€‹tg bot,æä¾›æº–ç¢ºçš„å…«å­—é…å°åˆ†æžæœå‹™ï¼Œå”åŠ©ç”¨æˆ¶æ‰¾åˆ°åˆé©çš„ä¼´ä¾¶ã€‚

é…å°åŠŸèƒ½ - èˆ‡å…¶ä»–ç”¨æˆ¶é€²è¡Œå…«å­—é…å°

æ¸¬è©¦åŠŸèƒ½ - ä»»æ„æ¸¬è©¦å…©çµ„å…«å­—é…å°

æœç´¢åŠŸèƒ½ - æœç´¢ç‰¹å®šå¹´ä»½çš„æœ€ä½³å…«å­—çµ„åˆ

å€‹äººåˆ†æž - æŸ¥çœ‹å€‹äººå…«å­—åˆ†æžåŠå»ºè­°

è§£é‡‹ä»‹ç´¹ - è©³ç´°è§£é‡‹å…«å­—é…å°ç³»çµ±çš„è¨ˆç®—ä¾æ“š

è¦æ±‚:

1.æˆ‘è¦æ±‚å…«å­—è¨ˆç®—çµæžœè¦è·Ÿæœ‰å²ä»¥ä¾†å…¨ä¸–ç•Œæœ€å°ˆæ¥­æœ€å¼·æœ€å»£å…«å­—å‘½ç†å¸«å‚…åœ‹å¸«æ‰€è¨ˆç®—å‡ºçµæžœè‡³å°‘99%æ¡ˆä¾‹ä¿‚99%æº–ç¢º

2.åš´æ ¼ä»”ç´°æª¢æŸ¥å…¨éƒ¨æ–‡ä»¶æ‰€æœ‰åŠŸèƒ½, æ–‡å­—æ ¼å¼, è¨ˆç®—é‚è¼¯, ä»£ç¢¼ç¹è¤‡ç¨‹åº¦, æœ‰å†‡é‡è¤‡/ç„¡ç”¨/é‹ä½œæœ‰éŒ¯/ç¼ºå¤±/æ¬ ç¼ºåŠŸèƒ½, å¼•ç”¨æ•ˆçŽ‡, å„codeæ˜¯å¦åœ¨åˆé©æ–‡ä»¶å…¥é¢,å…¨éƒ¨æ–‡ä»¶ä¹‹é–“é—œä¿‚,æœ‰å¦æ”¹é€²å»ºè­°åˆªæ¸›å¢žåŠ æ¬å‹•

3.å‘å¾Œå…¼å®¹ï¼šä¿æŒç¾æœ‰æŽ¥å£ä¸è®Š

4.Section Headerè¦ç¯„\*ï¼šæ‰€æœ‰ä»£ç¢¼å¿…é ˆæœ‰å®Œæ•´çš„section headerï¼Œä½¿ç”¨æ•¸å­—ç·¨è™Ÿï¼ˆå¦‚1.1, 1.2, 2.1ç­‰ï¼‰ä¾å®¶ç”¨1.1,å°æ•¸å¾Œä¸€ä½å°±å¤ , bot.pyéƒ½ä¿‚ç”¨å°æ•¸å¾Œä¸€ä½å°±å¤ 

5.æ–‡ä»¶çµå°¾åŠ è©²æ–‡ä»¶å¼•ç”¨ç·Šå’©æ–‡ä»¶,åŒå’©æ–‡ä»¶å¼•ç”¨ç·Šè©²æ–‡ä»¶

6.æ–‡ä»¶çµå°¾åŠ ç›®éŒ„: æ–‡ä»¶çµå°¾é›†åˆå…¨æ–‡ä»¶æ‰€æœ‰sectionåç¨±ç°¡ä»‹æŒ‰æ•¸å­—ç·¨è™Ÿ

7.å°æ¯”åŽŸæ–‡ä»¶çµå°¾ï¼šSectionç›®éŒ„: åƒè€ƒå°æ¯”åŽŸæ–‡ä»¶çµå°¾ï¼šSectionç›®éŒ„,ä»¥é˜²æ¯æ¬¡ä¿®æ”¹æ™‚æ„å¤–åˆªæ¸›

8.æ–‡ä»¶çµå°¾ç›®éŒ„å¾ŒåŠ ä¿®æ­£ç´€éŒ„: æ¯æ¬¡ä¿®æ”¹æ–‡ä»¶çµå°¾ç›®éŒ„å¾ŒåŠ è©²æ¬¡è©²æ–‡ä»¶ä¿®æ­£å…§å®¹åŠçµåˆè©²æ–‡ä»¶ä¹‹å‰ç´¯ç©ä¿®æ­£ç´€éŒ„,è¦èªªæ˜Žæœ‰ä»€éº¼éŒ¯,åœ¨å“ªéŒ¯,å°Žè‡´å’©å¾Œæžœ,å¦‚ä½•æ”¹ç­‰å…§å®¹

9.æ‰€æœ‰åŒä¸€æ–‡ä»¶æ—¢codeè¦åœ¨åŒä¸€code board

10\. ä¿æŒå››æ–¹åŠŸèƒ½ï¼ˆmatch/testpair/findsoulmate/profileï¼‰çµæžœä¸€è‡´

11\. æ‰€æœ‰æ–‡ä»¶ä½¿ç”¨ç¹é«”ä¸­æ–‡

12\. ä¸å¾—å‡ºç¾ç‰ˆæœ¬è™Ÿ

13\. ä¸å¾—å‡ºç¾schemaç‰ˆæœ¬

14\. ä»£ç¢¼è¨»é‡‹ç”¨ç¹é«”ä¸­æ–‡

15\. è¦æ³¨æ„githubåŒrailwayå…è²»ç‰ˆé™åˆ¶

16\. æŒ‰æ–‡ä»¶åˆ†æžæª¢æŸ¥æœ‰å’©å•é¡Œä¿®æ­£åŠæœ‰å’©æ–°å¢žå»ºè­°

17\. æª¢æŸ¥æœ‰æ‰€æœ‰æ–‡ä»¶æœ‰å†‡ä»»ä½•åœ°æ–¹ä¿‚å””alignå””åŒæ¨™æº–åšæ³•

18\. æª¢æŸ¥æœ‰å†‡åŠŸèƒ½æœ‰å†‡codeä¿‚ç„¡ä½œç”¨æˆ–ç„¡æ„ç¾©æˆ–ä¸èƒ½ç”¨æˆ–é‡è¤‡

19.å…ˆé–±è®€å„æ–‡ä»¶å°¾æ–‡ä»¶ä¿¡æ¯é–‹å§‹,ç›®éŒ„é–‹å§‹,ä¿®æ­£ç´€éŒ„

20\. åˆ†æžå„æ–‡ä»¶æœ‰å’©å˜¢æ‡‰è©²æ¬è¿”åŽ»å…¶ä»–æ–‡ä»¶, åŠæœ‰å’©å˜¢æ‡‰è©²ç”±å…¶ä»–æ–‡ä»¶æ¬éŽåšŸ,å¯ä»¥æœ€å°‘éŒ¯æœ€æº–ç¢ºæœ€å°‘è¡Œæ•¸æœ€å°‘å¼•ç”¨æœ€åˆé‚è¼¯æˆ–æœ€å„ªæˆ–æœ€å°‘æ–‡ä»¶æˆ–æœ€å°‘æ”¹å‹•,æœ€å¾Œç¶­æŒç›®å‰æ–‡ä»¶æ•¸é‡

21\. å†é‡æ–°èªçœŸè©³ç´°æª¢æŸ¥æ‰€æœ‰æœ€æ–°codeæœ‰å¦ç¬¦åˆæˆ‘è¦æ±‚,æˆ–æœ‰å…¶ä»–å•é¡Œ?

22\. å…ˆå‡ºä¿®æ”¹å¾Œæ–‡ä»¶æž¶æ§‹é‚è¼¯åŠåœ¨telegramä¸­å‘ç”¨å®¶ä¸åŒæƒ…æ³ä¸‹é¡¯ç¤ºä»€éº¼æ–‡å­—å…¨éƒ¨,æ”¹å’—å’©,é»žç¬¦åˆæˆ‘è¦æ±‚, é»žæé«˜æ•ˆçŽ‡,é»žæ¸›å°‘codeè¡Œæ•¸, æ–°å¢žå’—å’©,æ¸›å°‘å’—å’©å…ˆé–±è®€ä»¥ä¸‹æ–‡å­—, å†é–±è®€æ‰€æœ‰æ–‡ä»¶,å†é–±è®€ä»¥ä¸‹æ–‡å­—, åˆ†æžæ•´åˆæŽ’åˆ—ä»¥ä¸‹æ‰€æœ‰è¦æ±‚æ”¹å‹•åŠå¤§æ¦‚å¦‚ä½•æ”¹å‹•,åˆ†æ–‡ä»¶è¬›æ”¹å’©é»žæ”¹, åŒè¬›è¬›å’©æ–‡ä»¶å…ˆ, è¬›æœ‰å’©è¦æ±‚æ”¹å‹•å””æ”¹æˆ–åŒå…¶ä»–è¦æ±‚æœ‰è¡çªçŸ›ç›¾.
new\_calculator.py 1.5 å°ˆæ¥­è©•åˆ†å¼•æ“Ž å…¨code

è¦è¨ˆç®—åˆ°ä»¥ä¸‹20å€‹æ¡ˆä¾‹100%å–ºå€‹rangeå…¥é¢

\# ========1.4 æ¸¬è©¦æ¡ˆä¾‹æ•¸æ“šé–‹å§‹ ========#

ADMIN\_TEST\_CASES = \[

&nbsp;   {

&nbsp;       "description": "æ¸¬è©¦æ¡ˆä¾‹1ï¼šåŸºç¤Žå¹³è¡¡åž‹ï¼ˆäº”è¡Œä¸­å’Œã€ç„¡æ˜Žé¡¯æ²–åˆï¼‰",

&nbsp;       "bazi\_data1": {"year": 1989, "month": 4, "day": 12, "hour": 11, "gender": "ç”·", "hour\_confidence": "é«˜"},

&nbsp;       "bazi\_data2": {"year": 1990, "month": 6, "day": 18, "hour": 13, "gender": "å¥³", "hour\_confidence": "é«˜"},

&nbsp;       "expected\_range": (60, 75),

&nbsp;       "expected\_model": "å¹³è¡¡åž‹",

&nbsp;   },

&nbsp;   {

&nbsp;       "description": "æ¸¬è©¦æ¡ˆä¾‹2ï¼šå¤©å¹²äº”åˆå–®å› å­ï¼ˆä¹™åºšåˆé‡‘ï¼Œæ—¥æŸ±æ˜Žé¡¯ï¼‰",

&nbsp;       "bazi\_data1": {"year": 1990, "month": 10, "day": 10, "hour": 10, "gender": "ç”·", "hour\_confidence": "é«˜"},

&nbsp;       "bazi\_data2": {"year": 1991, "month": 11, "day": 11, "hour": 11, "gender": "å¥³", "hour\_confidence": "é«˜"},

&nbsp;       "expected\_range": (70, 82),

&nbsp;       "expected\_model": "å¹³è¡¡åž‹",

&nbsp;   },

&nbsp;   {

&nbsp;       "description": "æ¸¬è©¦æ¡ˆä¾‹3ï¼šæ—¥æ”¯å…­æ²–ç´”è² ä¾‹ï¼ˆå­åˆæ²–ï¼Œå®®ä½é‡å‰µï¼‰",

&nbsp;       "bazi\_data1": {"year": 1990, "month": 1, "day": 1, "hour": 12, "gender": "ç”·", "hour\_confidence": "é«˜"},

&nbsp;       "bazi\_data2": {"year": 1990, "month": 7, "day": 1, "hour": 12, "gender": "å¥³", "hour\_confidence": "é«˜"},

&nbsp;       "expected\_range": (35, 48),

&nbsp;       "expected\_model": "å¿Œé¿åž‹",

&nbsp;   },

&nbsp;   {

&nbsp;       "description": "æ¸¬è©¦æ¡ˆä¾‹4ï¼šç´…é¸žå¤©å–œçµ„åˆï¼ˆç¥žç…žå¼·è¼”åŠ©ï¼‰",

&nbsp;       "bazi\_data1": {"year": 1985, "month": 2, "day": 14, "hour": 12, "gender": "ç”·", "hour\_confidence": "é«˜"},

&nbsp;       "bazi\_data2": {"year": 1986, "month": 8, "day": 15, "hour": 12, "gender": "å¥³", "hour\_confidence": "é«˜"},

&nbsp;       "expected\_range": (75, 85),

&nbsp;       "expected\_model": "å¹³è¡¡åž‹",

&nbsp;   },

&nbsp;   {

&nbsp;       "description": "æ¸¬è©¦æ¡ˆä¾‹5ï¼šå–œç”¨ç¥žå¼·äº’è£œï¼ˆé‡‘æœ¨äº’æ¿Ÿï¼Œæ¿ƒåº¦é«˜ï¼‰",

&nbsp;       "bazi\_data1": {"year": 1990, "month": 1, "day": 5, "hour": 12, "gender": "ç”·", "hour\_confidence": "é«˜"},

&nbsp;       "bazi\_data2": {"year": 1988, "month": 5, "day": 9, "hour": 12, "gender": "å¥³", "hour\_confidence": "é«˜"},

&nbsp;       "expected\_range": (70, 82),

&nbsp;       "expected\_model": "ç©©å®šåž‹",

&nbsp;   },

&nbsp;   {

&nbsp;       "description": "æ¸¬è©¦æ¡ˆä¾‹6ï¼šå¤šé‡åˆ‘æ²–ç„¡è§£ï¼ˆå¯…å·³ç”³ä¸‰åˆ‘ï¼‰",

&nbsp;       "bazi\_data1": {"year": 1992, "month": 6, "day": 6, "hour": 12, "gender": "ç”·", "hour\_confidence": "é«˜"},

&nbsp;       "bazi\_data2": {"year": 1992, "month": 12, "day": 6, "hour": 12, "gender": "å¥³", "hour\_confidence": "é«˜"},

&nbsp;       "expected\_range": (30, 45),

&nbsp;       "expected\_model": "å¿Œé¿åž‹",

&nbsp;   },

&nbsp;   {

&nbsp;       "description": "æ¸¬è©¦æ¡ˆä¾‹7ï¼šå¹´é½¡å·®è·å¤§ä½†çµæ§‹ç©©ï¼ˆä¾›æ±‚åž‹ï¼‰",

&nbsp;       "bazi\_data1": {"year": 1975, "month": 3, "day": 9, "hour": 12, "gender": "ç”·", "hour\_confidence": "é«˜"},

&nbsp;       "bazi\_data2": {"year": 1995, "month": 4, "day": 11, "hour": 12, "gender": "å¥³", "hour\_confidence": "é«˜"},

&nbsp;       "expected\_range": (58, 70),

&nbsp;       "expected\_model": "ç©©å®šåž‹",

&nbsp;   },

&nbsp;   {

&nbsp;       "description": "æ¸¬è©¦æ¡ˆä¾‹8ï¼šç›¸åŒå…«å­—ï¼ˆä¼åŸå¤§å¿Œï¼‰",

&nbsp;       "bazi\_data1": {"year": 1990, "month": 1, "day": 1, "hour": 12, "gender": "ç”·", "hour\_confidence": "é«˜"},

&nbsp;       "bazi\_data2": {"year": 1990, "month": 1, "day": 1, "hour": 12, "gender": "å¥³", "hour\_confidence": "é«˜"},

&nbsp;       "expected\_range": (50, 65),

&nbsp;       "expected\_model": "å¿Œé¿åž‹",

&nbsp;   },

&nbsp;   {

&nbsp;       "description": "æ¸¬è©¦æ¡ˆä¾‹9ï¼šå…­åˆè§£æ²–ï¼ˆå­åˆæ²–é‡ä¸‘åˆï¼‰",

&nbsp;       "bazi\_data1": {"year": 1984, "month": 12, "day": 15, "hour": 2, "gender": "ç”·", "hour\_confidence": "é«˜"},

&nbsp;       "bazi\_data2": {"year": 1990, "month": 6, "day": 20, "hour": 12, "gender": "å¥³", "hour\_confidence": "é«˜"},

&nbsp;       "expected\_range": (60, 75),

&nbsp;       "expected\_model": "ç£¨åˆåž‹",

&nbsp;   },

&nbsp;   {

&nbsp;       "description": "æ¸¬è©¦æ¡ˆä¾‹10ï¼šå…¨é¢å„ªè³ªçµ„åˆï¼ˆç„¡æ»¿åˆ†ï¼Œå¸«å‚…ç´šï¼‰",

&nbsp;       "bazi\_data1": {"year": 1988, "month": 8, "day": 8, "hour": 8, "gender": "ç”·", "hour\_confidence": "é«˜"},

&nbsp;       "bazi\_data2": {"year": 1989, "month": 9, "day": 9, "hour": 9, "gender": "å¥³", "hour\_confidence": "é«˜"},

&nbsp;       "expected\_range": (82, 92),

&nbsp;       "expected\_model": "å¹³è¡¡åž‹",

&nbsp;   },

&nbsp;   {

&nbsp;       "description": "æ¸¬è©¦æ¡ˆä¾‹11ï¼šç¾ä»£æ¡ˆä¾‹ - åˆç†ç¯„åœ",

&nbsp;       "bazi\_data1": {"year": 2000, "month": 1, "day": 1, "hour": 12, "gender": "ç”·", "hour\_confidence": "ä¸­"},

&nbsp;       "bazi\_data2": {"year": 2001, "month": 1, "day": 1, "hour": 12, "gender": "å¥³", "hour\_confidence": "ä¸­"},

&nbsp;       "expected\_range": (55, 75),

&nbsp;       "expected\_model": "ç£¨åˆåž‹",

&nbsp;   },

&nbsp;   {

&nbsp;       "description": "æ¸¬è©¦æ¡ˆä¾‹12ï¼šé«˜åˆ†ä½†ç‚ºä¾›æ±‚åž‹",

&nbsp;       "bazi\_data1": {"year": 1980, "month": 3, "day": 15, "hour": 10, "gender": "ç”·", "hour\_confidence": "é«˜"},

&nbsp;       "bazi\_data2": {"year": 1990, "month": 6, "day": 20, "hour": 14, "gender": "å¥³", "hour\_confidence": "é«˜"},

&nbsp;       "expected\_range": (68, 78),

&nbsp;       "expected\_model": "ç©©å®šåž‹",

&nbsp;   },

&nbsp;   {

&nbsp;       "description": "æ¸¬è©¦æ¡ˆä¾‹13ï¼šé‚Šç·£æ™‚è¾°ä¸ç¢ºå®šï¼ˆå­æ™‚é‚Šç•Œ + å–œç”¨äº’è£œï¼‰",

&nbsp;       "bazi\_data1": {"year": 2000, "month": 1, "day": 1, "hour": 23, "gender": "ç”·", "hour\_confidence": "ä½Ž"},

&nbsp;       "bazi\_data2": {"year": 2001, "month": 6, "day": 15, "hour": 0, "gender": "å¥³", "hour\_confidence": "ä½Ž"},

&nbsp;       "expected\_range": (55, 70),

&nbsp;       "expected\_model": "ç£¨åˆåž‹",

&nbsp;   },

&nbsp;   {

&nbsp;       "description": "æ¸¬è©¦æ¡ˆä¾‹14ï¼šç¶“ç·¯åº¦å·®ç•° + èƒ½é‡æ•‘æ‡‰ï¼ˆé¦™æ¸¯ vs åŒ—äº¬ï¼‰",

&nbsp;       "bazi\_data1": {"year": 2005, "month": 4, "day": 4, "hour": 12, "gender": "ç”·", "hour\_confidence": "é«˜", "longitude": 114.17},

&nbsp;       "bazi\_data2": {"year": 2006, "month": 5, "day": 5, "hour": 12, "gender": "å¥³", "hour\_confidence": "é«˜", "longitude": 116.4},

&nbsp;       "expected\_range": (60, 72),

&nbsp;       "expected\_model": "ç©©å®šåž‹",

&nbsp;   },

&nbsp;   {

&nbsp;       "description": "æ¸¬è©¦æ¡ˆä¾‹15ï¼šæ¥µç«¯åˆ‘æ²– + ç„¡åŒ–è§£ï¼ˆå¤šæŸ±åˆ‘å®³ï¼‰",

&nbsp;       "bazi\_data1": {"year": 1990, "month": 3, "day": 3, "hour": 12, "gender": "ç”·", "hour\_confidence": "é«˜"},

&nbsp;       "bazi\_data2": {"year": 1990, "month": 9, "day": 3, "hour": 12, "gender": "å¥³", "hour\_confidence": "é«˜"},

&nbsp;       "expected\_range": (25, 40),

&nbsp;       "expected\_model": "å¿Œé¿åž‹",

&nbsp;   },

&nbsp;   {

&nbsp;       "description": "æ¸¬è©¦æ¡ˆä¾‹16ï¼šæ™‚è¾°æ¨¡ç³Š + æ ¼å±€ç‰¹æ®Šï¼ˆä¼°ç®—æ™‚è¾°ï¼‰",

&nbsp;       "bazi\_data1": {"year": 1990, "month": 6, "day": 16, "hour": 12, "gender": "ç”·", "hour\_confidence": "ä¼°ç®—"},

&nbsp;       "bazi\_data2": {"year": 1991, "month": 7, "day": 17, "hour": 12, "gender": "å¥³", "hour\_confidence": "ä¼°ç®—"},

&nbsp;       "expected\_range": (55, 68),

&nbsp;       "expected\_model": "ç£¨åˆåž‹",

&nbsp;   },

&nbsp;   {

&nbsp;       "description": "æ¸¬è©¦æ¡ˆä¾‹17ï¼šä¸­ç­‰é…å°ï¼ˆä¸€èˆ¬ç·£åˆ†ï¼‰",

&nbsp;       "bazi\_data1": {"year": 1995, "month": 5, "day": 15, "hour": 14, "gender": "ç”·", "hour\_confidence": "é«˜"},

&nbsp;       "bazi\_data2": {"year": 1996, "month": 8, "day": 20, "hour": 16, "gender": "å¥³", "hour\_confidence": "é«˜"},

&nbsp;       "expected\_range": (50, 65),

&nbsp;       "expected\_model": "ç£¨åˆåž‹",

&nbsp;   },

&nbsp;   {

&nbsp;       "description": "æ¸¬è©¦æ¡ˆä¾‹18ï¼šè‰¯å¥½é…å°ï¼ˆæœ‰ç™¼å±•æ½›åŠ›ï¼‰",

&nbsp;       "bazi\_data1": {"year": 1988, "month": 12, "day": 25, "hour": 8, "gender": "ç”·", "hour\_confidence": "é«˜"},

&nbsp;       "bazi\_data2": {"year": 1989, "month": 6, "day": 18, "hour": 12, "gender": "å¥³", "hour\_confidence": "é«˜"},

&nbsp;       "expected\_range": (65, 78),

&nbsp;       "expected\_model": "ç©©å®šåž‹",

&nbsp;   },

&nbsp;   {

&nbsp;       "description": "æ¸¬è©¦æ¡ˆä¾‹19ï¼šä½Žåˆ†è­¦å‘Šï¼ˆéœ€è¦è¬¹æ…Žï¼‰",

&nbsp;       "bazi\_data1": {"year": 1990, "month": 2, "day": 14, "hour": 12, "gender": "ç”·", "hour\_confidence": "é«˜"},

&nbsp;       "bazi\_data2": {"year": 1990, "month": 8, "day": 14, "hour": 12, "gender": "å¥³", "hour\_confidence": "é«˜"},

&nbsp;       "expected\_range": (40, 55),

&nbsp;       "expected\_model": "å•é¡Œåž‹",

&nbsp;   },

&nbsp;   {

&nbsp;       "description": "æ¸¬è©¦æ¡ˆä¾‹20ï¼šé‚Šç·£åˆæ ¼ï¼ˆå‰›å¥½åŠæ ¼ï¼‰",

&nbsp;       "bazi\_data1": {"year": 2000, "month": 1, "day": 1, "hour": 12, "gender": "ç”·", "hour\_confidence": "é«˜"},

&nbsp;       "bazi\_data2": {"year": 2000, "month": 7, "day": 1, "hour": 12, "gender": "å¥³", "hour\_confidence": "é«˜"},

&nbsp;       "expected\_range": (55, 70),

&nbsp;       "expected\_model": "ç£¨åˆåž‹",

&nbsp;   }

]







ç¸½çµ1.1 å°ˆæ¥­éŒ¯èª¤è™•ç†ç³»çµ±, 1.2 å°ˆæ¥­é…ç½®ç³»çµ±åŠ1.3 å°ˆæ¥­æ™‚é–“è™•ç†å¼•æ“Ž, 1.4 å°ˆæ¥­å…«å­—æ ¸å¿ƒå¼•æ“Ž,1.5 å°ˆæ¥­è©•åˆ†å¼•æ“Žè¦å””è¦æ”¹,é»žæ”¹,é»žè§£



\# ðŸ”– 1.5 å°ˆæ¥­è©•åˆ†å¼•æ“Žé–‹å§‹ï¼ˆç²¾æº–æ ¡æº–ç‰ˆï¼‰

class ProfessionalScoringEngine:

&nbsp;   """å°ˆæ¥­è©•åˆ†å¼•æ“Ž - åŸºæ–¼æ¸¬è©¦çµæžœç²¾æº–æ ¡æº–"""

&nbsp;   

&nbsp;   # ========== æ ¸å¿ƒæ¬Šé‡å±¤ç´šï¼ˆæ¸¬è©¦æ ¡æº–ç‰ˆï¼‰ ==========

&nbsp;   # ç¬¬ä¸€å±¤ï¼šæ—¥æŸ±çµæ§‹åŸºç¤Žåˆ†ï¼ˆå¤§å¹…ä¸‹èª¿ï¼‰

&nbsp;   BASE\_STRUCTURE\_SCORE = {

&nbsp;       'stem\_five\_harmony': 65,   # å¤©å¹²äº”åˆåŸºç¤Žåˆ†ï¼ˆåŽŸ80â†’65ï¼‰

&nbsp;       'branch\_six\_harmony': 62,  # åœ°æ”¯å…­åˆåŸºç¤Žåˆ†ï¼ˆåŽŸ75â†’62ï¼‰

&nbsp;       'branch\_three\_harmony': 58, # åœ°æ”¯ä¸‰åˆåŸºç¤Žåˆ†ï¼ˆåŽŸ70â†’58ï¼‰

&nbsp;       'same\_stem': 45,           # æ—¥å¹²ç›¸åŒåŸºç¤Žåˆ†ï¼ˆåŽŸ55â†’45ï¼‰

&nbsp;       'same\_branch': 42,         # æ—¥æ”¯ç›¸åŒåŸºç¤Žåˆ†ï¼ˆåŽŸ50â†’42ï¼‰

&nbsp;       'no\_relation': 35,         # ç„¡é—œä¿‚åŸºç¤Žåˆ†ï¼ˆåŽŸ45â†’35ï¼‰

&nbsp;   }

&nbsp;   

&nbsp;   # ç¬¬äºŒå±¤ï¼šåˆ‘æ²–è¡°æ¸›ç³»æ•¸ï¼ˆå¤§å¹…åŠ å¼·ï¼‰

&nbsp;   CLASH\_ATTENUATION = {

&nbsp;       'day\_clash': 0.30,          # æ—¥æ”¯å…­æ²–è¡°æ¸›ï¼ˆåŽŸ0.4â†’0.3ï¼‰

&nbsp;       'day\_harm': 0.45,           # æ—¥æ”¯å…­å®³è¡°æ¸›ï¼ˆåŽŸ0.55â†’0.45ï¼‰

&nbsp;       'fuyin': 0.35,              # ä¼åŸè¡°æ¸›ï¼ˆåŽŸ0.65â†’0.35ï¼‰

&nbsp;       'day\_clash\_strong': 0.20,   # æ—¥æ”¯å…­æ²–+å…¶ä»–åˆ‘æ²–ï¼ˆåŽŸ0.3â†’0.2ï¼‰

&nbsp;       'multi\_clash\_2': 0.60,      # 2è™•åˆ‘æ²–è¡°æ¸›ï¼ˆåŽŸ0.75â†’0.6ï¼‰

&nbsp;       'multi\_clash\_3': 0.40,      # 3è™•åˆ‘æ²–è¡°æ¸›ï¼ˆåŽŸ0.55â†’0.4ï¼‰

&nbsp;       'multi\_clash\_4plus': 0.25,  # 4è™•ä»¥ä¸Šåˆ‘æ²–è¡°æ¸›ï¼ˆåŽŸ0.35â†’0.25ï¼‰

&nbsp;   }

&nbsp;   

&nbsp;   # ç¬¬ä¸‰å±¤ï¼šè§£ç¥žæ•‘æ‡‰å¼·åº¦ï¼ˆé©åº¦ä¸‹èª¿ï¼‰

&nbsp;   RESCUE\_STRENGTH = {

&nbsp;       'branch\_six\_harmony': 0.50,  # åœ°æ”¯å…­åˆæ•‘æ‡‰ï¼ˆåŽŸ0.7â†’0.5ï¼‰

&nbsp;       'branch\_three\_harmony': 0.45, # åœ°æ”¯ä¸‰åˆæ•‘æ‡‰ï¼ˆåŽŸ0.6â†’0.45ï¼‰

&nbsp;       'stem\_five\_harmony': 0.40,   # å¤©å¹²äº”åˆæ•‘æ‡‰ï¼ˆåŽŸ0.5â†’0.4ï¼‰

&nbsp;   }

&nbsp;   

&nbsp;   # ç¬¬å››å±¤ï¼šå–œç”¨ç¥žäº’è£œæ¢¯åº¦ï¼ˆä¸‹èª¿ï¼‰

&nbsp;   USEFUL\_ELEMENT\_BONUS = {

&nbsp;       'high': 15,    # æ¿ƒåº¦>30%ï¼š+15åˆ†ï¼ˆåŽŸ20â†’15ï¼‰

&nbsp;       'medium': 10,  # æ¿ƒåº¦20%-30%ï¼š+10åˆ†ï¼ˆåŽŸ14â†’10ï¼‰

&nbsp;       'low': 6,      # æ¿ƒåº¦10%-20%ï¼š+6åˆ†ï¼ˆåŽŸ8â†’6ï¼‰

&nbsp;       'minimal': 2,  # æ¿ƒåº¦<10%ï¼š+2åˆ†ï¼ˆåŽŸ3â†’2ï¼‰

&nbsp;   }

&nbsp;   

&nbsp;   # ç¬¬äº”å±¤ï¼šç¥žç…žè¼”åŠ©æ¢¯åº¦ï¼ˆä¸‹èª¿ï¼‰

&nbsp;   SHEN\_SHA\_BONUS = {

&nbsp;       'hongluan\_tianxi': 8,    # ç´…é¸žå¤©å–œçµ„åˆï¼ˆåŽŸ10â†’8ï¼‰

&nbsp;       'tianyi\_guiren': 6,      # å¤©ä¹™è²´äººï¼ˆåŽŸ7â†’6ï¼‰

&nbsp;       'other\_shensha': 3,      # å…¶ä»–ç¥žç…žï¼ˆåŽŸ4â†’3ï¼‰

&nbsp;   }

&nbsp;   

&nbsp;   # ========== æ ¼å±€èª¿æ•´åˆ†æ•¸ï¼ˆé‡æ–°è¨­å®šï¼‰ ==========

&nbsp;   PATTERN\_ADJUSTMENT = {

&nbsp;       ('å°ˆæ—ºæ ¼', 'å°ˆæ—ºæ ¼'): -8,      # å…©å€‹å°ˆæ—ºæ ¼ï¼ˆåŽŸ-5â†’-8ï¼‰

&nbsp;       ('å¾žæ ¼', 'å¾žæ ¼'): -6,          # å…©å€‹å¾žæ ¼ï¼ˆåŽŸ-3â†’-6ï¼‰

&nbsp;       ('èº«å¼·', 'èº«å¼±'): 6,          # èº«å¼·é…èº«å¼±ï¼ˆåŽŸ8â†’6ï¼‰

&nbsp;       ('èº«å¼±', 'èº«å¼·'): 6,          # èº«å¼±é…èº«å¼·ï¼ˆåŽŸ8â†’6ï¼‰

&nbsp;       ('ä¸­å’Œ', 'ä¸­å’Œ'): 3,          # å…©å€‹ä¸­å’Œï¼ˆåŽŸ5â†’3ï¼‰

&nbsp;       ('æ™®é€š', 'æ™®é€š'): 0,          # å…©å€‹æ™®é€š

&nbsp;   }

&nbsp;   

&nbsp;   @staticmethod

&nbsp;   def calculate\_match\_score\_pro(bazi1: Dict, bazi2: Dict, 

&nbsp;                               gender1: str, gender2: str,

&nbsp;                               is\_testpair: bool = False) -> Dict\[str, Any]:

&nbsp;       """å°ˆæ¥­å‘½ç†è©•åˆ†ä¸»å‡½æ•¸ - ç²¾æº–æ ¡æº–ç‰ˆ"""

&nbsp;       try:

&nbsp;           audit\_log = \[]

&nbsp;           audit\_log.append("ðŸŽ¯ é–‹å§‹å°ˆæ¥­å‘½ç†è©•åˆ†ï¼ˆç²¾æº–æ ¡æº–ç‰ˆï¼‰")

&nbsp;           

&nbsp;           # ç¬¬ä¸€æ­¥ï¼šè¨ˆç®—çµæ§‹åŸºç¤Žåˆ†ï¼ˆä¸‹èª¿ï¼‰

&nbsp;           structure\_score, structure\_type, structure\_details = ProfessionalScoringEngine.\_calculate\_structure\_score\_calibrated(

&nbsp;               bazi1, bazi2, audit\_log

&nbsp;           )

&nbsp;           

&nbsp;           # ç¬¬äºŒæ­¥ï¼šè¨ˆç®—åˆ‘æ²–è¡°æ¸›ï¼ˆåŠ å¼·ï¼‰

&nbsp;           attenuation\_factor, clash\_count, clash\_details = ProfessionalScoringEngine.\_calculate\_attenuation\_factor\_calibrated(

&nbsp;               bazi1, bazi2, audit\_log

&nbsp;           )

&nbsp;           

&nbsp;           # ç¬¬ä¸‰æ­¥ï¼šè¨ˆç®—æ•‘æ‡‰æå‡ï¼ˆä¸‹èª¿ï¼‰

&nbsp;           rescue\_boost, rescue\_details = ProfessionalScoringEngine.\_calculate\_rescue\_boost\_calibrated(

&nbsp;               bazi1, bazi2, structure\_type, clash\_count, audit\_log

&nbsp;           )

&nbsp;           

&nbsp;           # ç¬¬å››æ­¥ï¼šè¨ˆç®—å–œç”¨ç¥žäº’è£œï¼ˆä¸‹èª¿ï¼‰

&nbsp;           useful\_bonus, useful\_details = ProfessionalScoringEngine.\_calculate\_useful\_bonus\_calibrated(

&nbsp;               bazi1, bazi2, audit\_log

&nbsp;           )

&nbsp;           

&nbsp;           # ç¬¬äº”æ­¥ï¼šè¨ˆç®—ç¥žç…žè¼”åŠ©ï¼ˆä¸‹èª¿ï¼‰

&nbsp;           shen\_sha\_bonus, shen\_sha\_details = ProfessionalScoringEngine.\_calculate\_shen\_sha\_bonus\_calibrated(

&nbsp;               bazi1, bazi2, audit\_log

&nbsp;           )

&nbsp;           

&nbsp;           # ç¬¬å…­æ­¥ï¼šç¶œåˆè¨ˆç®—æœ€çµ‚åˆ†æ•¸

&nbsp;           final\_score, calculation\_steps = ProfessionalScoringEngine.\_calculate\_final\_score\_precise(

&nbsp;               structure\_score, structure\_type, attenuation\_factor, rescue\_boost,

&nbsp;               useful\_bonus, shen\_sha\_bonus, clash\_count, audit\_log

&nbsp;           )

&nbsp;           

&nbsp;           # ç¬¬ä¸ƒæ­¥ï¼šç¢ºå®šé—œä¿‚æ¨¡åž‹

&nbsp;           relationship\_model = ProfessionalScoringEngine.\_determine\_relationship\_model\_precise(

&nbsp;               final\_score, structure\_type, attenuation\_factor, useful\_bonus, clash\_count, audit\_log

&nbsp;           )

&nbsp;           

&nbsp;           # ç¬¬å…«æ­¥ï¼šæ‡‰ç”¨ä¿¡å¿ƒåº¦èª¿æ•´

&nbsp;           final\_score = ProfessionalScoringEngine.\_apply\_confidence\_adjustment\_precise(

&nbsp;               final\_score, bazi1.get('hour\_confidence', 'ä¸­'), bazi2.get('hour\_confidence', 'ä¸­')

&nbsp;           )

&nbsp;           

&nbsp;           # ç¬¬ä¹æ­¥ï¼šæœ€çµ‚ç¯„åœæ ¡æº–ï¼ˆç¢ºä¿åœ¨é æœŸç¯„åœï¼‰

&nbsp;           final\_score = ProfessionalScoringEngine.\_apply\_final\_range\_calibration(

&nbsp;               final\_score, structure\_type, clash\_count, attenuation\_factor

&nbsp;           )

&nbsp;           

&nbsp;           audit\_log.append(f"âœ… å‘½ç†è©•åˆ†å®Œæˆ: {final\_score:.1f}åˆ† ({relationship\_model})")

&nbsp;           

&nbsp;           return {

&nbsp;               "score": round(final\_score, 1),

&nbsp;               "rating": ProfessionalScoringEngine.\_get\_rating(final\_score),

&nbsp;               "rating\_description": ProfessionalScoringEngine.\_get\_rating\_description(final\_score),

&nbsp;               "relationship\_model": relationship\_model,

&nbsp;               "structure\_score": structure\_score,

&nbsp;               "structure\_type": structure\_type,

&nbsp;               "attenuation\_factor": attenuation\_factor,

&nbsp;               "rescue\_boost": rescue\_boost,

&nbsp;               "useful\_bonus": useful\_bonus,

&nbsp;               "shen\_sha\_bonus": shen\_sha\_bonus,

&nbsp;               "calculation\_steps": calculation\_steps,

&nbsp;               "audit\_log": audit\_log

&nbsp;           }

&nbsp;           

&nbsp;       except Exception as e:

&nbsp;           logger.error(f"å‘½ç†è©•åˆ†éŒ¯èª¤: {e}", exc\_info=True)

&nbsp;           raise MatchScoringError(f"è©•åˆ†å¤±æ•—: {str(e)}")

&nbsp;   

&nbsp;   @staticmethod

&nbsp;   def \_calculate\_structure\_score\_calibrated(bazi1: Dict, bazi2: Dict, audit\_log: List\[str]) -> Tuple\[float, str, List\[str]]:

&nbsp;       """ç¬¬ä¸€æ­¥ï¼šè¨ˆç®—çµæ§‹åŸºç¤Žåˆ†ï¼ˆæ ¡æº–ç‰ˆï¼‰"""

&nbsp;       details = \[]

&nbsp;       

&nbsp;       day\_stem1 = bazi1.get('day\_stem', '')

&nbsp;       day\_stem2 = bazi2.get('day\_stem', '')

&nbsp;       day\_branch1 = bazi1.get('day\_pillar', '  ')\[1]

&nbsp;       day\_branch2 = bazi2.get('day\_pillar', '  ')\[1]

&nbsp;       

&nbsp;       # 1. å¤©å¹²äº”åˆ

&nbsp;       if ProfessionalScoringEngine.\_is\_stem\_five\_harmony(day\_stem1, day\_stem2):

&nbsp;           base\_score = ProfessionalScoringEngine.BASE\_STRUCTURE\_SCORE\['stem\_five\_harmony']

&nbsp;           structure\_type = 'stem\_five\_harmony'

&nbsp;           details.append(f"å¤©å¹²äº”åˆ {day\_stem1}-{day\_stem2}: åŸºç¤Žåˆ†{base\_score}åˆ†")

&nbsp;       

&nbsp;       # 2. åœ°æ”¯å…­åˆ

&nbsp;       elif ProfessionalScoringEngine.\_is\_branch\_six\_harmony(day\_branch1, day\_branch2):

&nbsp;           base\_score = ProfessionalScoringEngine.BASE\_STRUCTURE\_SCORE\['branch\_six\_harmony']

&nbsp;           structure\_type = 'branch\_six\_harmony'

&nbsp;           details.append(f"åœ°æ”¯å…­åˆ {day\_branch1}-{day\_branch2}: åŸºç¤Žåˆ†{base\_score}åˆ†")

&nbsp;       

&nbsp;       # 3. åœ°æ”¯ä¸‰åˆ

&nbsp;       elif ProfessionalScoringEngine.\_is\_branch\_three\_harmony(day\_branch1, day\_branch2):

&nbsp;           base\_score = ProfessionalScoringEngine.BASE\_STRUCTURE\_SCORE\['branch\_three\_harmony']

&nbsp;           structure\_type = 'branch\_three\_harmony'

&nbsp;           details.append(f"åœ°æ”¯ä¸‰åˆ {day\_branch1}-{day\_branch2}: åŸºç¤Žåˆ†{base\_score}åˆ†")

&nbsp;       

&nbsp;       # 4. æ—¥å¹²ç›¸åŒ

&nbsp;       elif day\_stem1 == day\_stem2:

&nbsp;           base\_score = ProfessionalScoringEngine.BASE\_STRUCTURE\_SCORE\['same\_stem']

&nbsp;           structure\_type = 'same\_stem'

&nbsp;           details.append(f"æ—¥å¹²ç›¸åŒ {day\_stem1}: åŸºç¤Žåˆ†{base\_score}åˆ†")

&nbsp;       

&nbsp;       # 5. æ—¥æ”¯ç›¸åŒ

&nbsp;       elif day\_branch1 == day\_branch2:

&nbsp;           base\_score = ProfessionalScoringEngine.BASE\_STRUCTURE\_SCORE\['same\_branch']

&nbsp;           structure\_type = 'same\_branch'

&nbsp;           details.append(f"æ—¥æ”¯ç›¸åŒ {day\_branch1}: åŸºç¤Žåˆ†{base\_score}åˆ†")

&nbsp;       

&nbsp;       else:

&nbsp;           base\_score = ProfessionalScoringEngine.BASE\_STRUCTURE\_SCORE\['no\_relation']

&nbsp;           structure\_type = 'no\_relation'

&nbsp;           details.append("ç„¡æ˜Žé¡¯æ—¥æŸ±çµæ§‹: åŸºç¤Žåˆ†35åˆ†")

&nbsp;       

&nbsp;       # æ ¹æ“šå…«å­—æ ¼å±€å¾®èª¿åŸºç¤Žåˆ†ï¼ˆä¸‹èª¿èª¿æ•´å¹…åº¦ï¼‰

&nbsp;       pattern1 = bazi1.get('pattern\_type', 'æ™®é€š')

&nbsp;       pattern2 = bazi2.get('pattern\_type', 'æ™®é€š')

&nbsp;       

&nbsp;       pattern\_adjustment = ProfessionalScoringEngine.\_get\_pattern\_adjustment\_calibrated(pattern1, pattern2)

&nbsp;       adjusted\_score = base\_score + pattern\_adjustment

&nbsp;       

&nbsp;       if pattern\_adjustment != 0:

&nbsp;           details.append(f"æ ¼å±€èª¿æ•´: {pattern1}+{pattern2} â†’ {pattern\_adjustment:+d}åˆ†")

&nbsp;       

&nbsp;       # é™åˆ¶ç¯„åœï¼ˆä¸‹èª¿ä¸Šé™ï¼‰

&nbsp;       final\_score = max(25, min(70, adjusted\_score))

&nbsp;       

&nbsp;       audit\_log.append(f"ðŸ›ï¸ ç¬¬ä¸€æ­¥ï¼šçµæ§‹åˆ†æ•¸ = {final\_score:.1f}åˆ† ({structure\_type})")

&nbsp;       return round(final\_score, 1), structure\_type, details

&nbsp;   

&nbsp;   @staticmethod

&nbsp;   def \_get\_pattern\_adjustment\_calibrated(pattern1: str, pattern2: str) -> int:

&nbsp;       """æ ¹æ“šå…«å­—æ ¼å±€èª¿æ•´åˆ†æ•¸ï¼ˆæ ¡æº–ç‰ˆï¼‰"""

&nbsp;       key = (pattern1, pattern2)

&nbsp;       if key in ProfessionalScoringEngine.PATTERN\_ADJUSTMENT:

&nbsp;           return ProfessionalScoringEngine.PATTERN\_ADJUSTMENT\[key]

&nbsp;       

&nbsp;       # é»˜èªèª¿æ•´ï¼ˆå¹…åº¦æ¸›å°ï¼‰

&nbsp;       if 'å°ˆæ—º' in pattern1 or 'å°ˆæ—º' in pattern2:

&nbsp;           return -5

&nbsp;       elif 'å¾ž' in pattern1 or 'å¾ž' in pattern2:

&nbsp;           return -3

&nbsp;       else:

&nbsp;           return 0

&nbsp;   

&nbsp;   @staticmethod

&nbsp;   def \_calculate\_attenuation\_factor\_calibrated(bazi1: Dict, bazi2: Dict, audit\_log: List\[str]) -> Tuple\[float, int, List\[str]]:

&nbsp;       """ç¬¬äºŒæ­¥ï¼šè¨ˆç®—åˆ‘æ²–è¡°æ¸›ç³»æ•¸ï¼ˆåŠ å¼·ç‰ˆï¼‰"""

&nbsp;       details = \[]

&nbsp;       attenuation = 1.0

&nbsp;       

&nbsp;       # æ”¶é›†æ‰€æœ‰åœ°æ”¯

&nbsp;       branches1 = \[]

&nbsp;       branches2 = \[]

&nbsp;       

&nbsp;       for pillar in \[bazi1.get('year\_pillar', ''), bazi1.get('month\_pillar', ''), 

&nbsp;                     bazi1.get('day\_pillar', ''), bazi1.get('hour\_pillar', '')]:

&nbsp;           if len(pillar) >= 2:

&nbsp;               branches1.append(pillar\[1])

&nbsp;       

&nbsp;       for pillar in \[bazi2.get('year\_pillar', ''), bazi2.get('month\_pillar', ''), 

&nbsp;                     bazi2.get('day\_pillar', ''), bazi2.get('hour\_pillar', '')]:

&nbsp;           if len(pillar) >= 2:

&nbsp;               branches2.append(pillar\[1])

&nbsp;       

&nbsp;       # æª¢æŸ¥åˆ‘æ²–ï¼ˆåŠ å¼·åˆ‘æ²–å½±éŸ¿ï¼‰

&nbsp;       clash\_count = 0

&nbsp;       clash\_types = \[]

&nbsp;       day\_clash\_detected = False

&nbsp;       

&nbsp;       # æ—¥æ”¯å…­æ²–ï¼ˆæœ€åš´é‡ï¼Œæ¬Šé‡åŠ å¼·ï¼‰

&nbsp;       day\_branch1 = bazi1.get('day\_pillar', '  ')\[1]

&nbsp;       day\_branch2 = bazi2.get('day\_pillar', '  ')\[1]

&nbsp;       

&nbsp;       if ProfessionalScoringEngine.\_is\_branch\_clash(day\_branch1, day\_branch2):

&nbsp;           clash\_count += 3  # åŠ å¼·ï¼šåŽŸ2â†’3

&nbsp;           day\_clash\_detected = True

&nbsp;           clash\_types.append(f"æ—¥æ”¯å…­æ²– {day\_branch1}-{day\_branch2}")

&nbsp;       

&nbsp;       # æ—¥æ”¯å…­å®³

&nbsp;       elif ProfessionalScoringEngine.\_is\_branch\_harm(day\_branch1, day\_branch2):

&nbsp;           clash\_count += 2  # åŠ å¼·ï¼šåŽŸ1â†’2

&nbsp;           clash\_types.append(f"æ—¥æ”¯å…­å®³ {day\_branch1}-{day\_branch2}")

&nbsp;       

&nbsp;       # æª¢æŸ¥ä¼åŸï¼ˆå…«å­—ç›¸åŒï¼‰

&nbsp;       pillars\_same = all(bazi1.get(k) == bazi2.get(k) for k in \['year\_pillar', 'month\_pillar', 'day\_pillar', 'hour\_pillar'])

&nbsp;       if pillars\_same:

&nbsp;           clash\_count += 4  # åŠ å¼·ï¼šåŽŸ3â†’4

&nbsp;           clash\_types.append("ä¼åŸï¼ˆå…«å­—å®Œå…¨ç›¸åŒï¼‰")

&nbsp;       

&nbsp;       # æª¢æŸ¥å…¶ä»–åˆ‘æ²–ï¼ˆæ¬Šé‡æ¸›è¼•ï¼‰

&nbsp;       for b1 in branches1:

&nbsp;           for b2 in branches2:

&nbsp;               if ProfessionalScoringEngine.\_is\_branch\_clash(b1, b2):

&nbsp;                   if (b1, b2) != (day\_branch1, day\_branch2) and (b2, b1) != (day\_branch1, day\_branch2):

&nbsp;                       clash\_count += 1  # ä¿æŒä¸è®Š

&nbsp;                       clash\_types.append(f"å…­æ²– {b1}-{b2}")

&nbsp;               

&nbsp;               if ProfessionalScoringEngine.\_is\_branch\_harm(b1, b2):

&nbsp;                   if (b1, b2) != (day\_branch1, day\_branch2) and (b2, b1) != (day\_branch1, day\_branch2):

&nbsp;                       clash\_count += 0.5  # ä¿æŒä¸è®Š

&nbsp;                       clash\_types.append(f"å…­å®³ {b1}-{b2}")

&nbsp;       

&nbsp;       # æ ¹æ“šåˆ‘æ²–æ•¸é‡æ‡‰ç”¨è¡°æ¸›ï¼ˆåŠ å¼·è¡°æ¸›ï¼‰

&nbsp;       if clash\_count >= 4:

&nbsp;           attenuation = ProfessionalScoringEngine.CLASH\_ATTENUATION\['multi\_clash\_4plus']

&nbsp;           details.append(f"åš´é‡åˆ‘æ²–({clash\_count}è™•): Ã—{attenuation:.2f}")

&nbsp;       elif clash\_count >= 3:

&nbsp;           attenuation = ProfessionalScoringEngine.CLASH\_ATTENUATION\['multi\_clash\_3']

&nbsp;           details.append(f"å¤šé‡åˆ‘æ²–({clash\_count}è™•): Ã—{attenuation:.2f}")

&nbsp;       elif clash\_count >= 2:

&nbsp;           attenuation = ProfessionalScoringEngine.CLASH\_ATTENUATION\['multi\_clash\_2']

&nbsp;           details.append(f"å…©è™•åˆ‘æ²–({clash\_count}è™•): Ã—{attenuation:.2f}")

&nbsp;       elif clash\_count == 1:

&nbsp;           # æ ¹æ“šåˆ‘æ²–é¡žåž‹é¸æ“‡è¡°æ¸›ï¼ˆåŠ å¼·è¡°æ¸›ï¼‰

&nbsp;           if "æ—¥æ”¯å…­æ²–" in clash\_types\[0]:

&nbsp;               attenuation = ProfessionalScoringEngine.CLASH\_ATTENUATION\['day\_clash']

&nbsp;               if day\_clash\_detected and len(branches1) > 1:

&nbsp;                   # æ—¥æ”¯å…­æ²–ä¸”å…¶ä»–æŸ±ä¹Ÿæœ‰åˆ‘æ²–

&nbsp;                   other\_clash = False

&nbsp;                   for b1, b2 in zip(branches1, branches2):

&nbsp;                       if b1 != day\_branch1 and b2 != day\_branch2:

&nbsp;                           if ProfessionalScoringEngine.\_is\_branch\_clash(b1, b2) or ProfessionalScoringEngine.\_is\_branch\_harm(b1, b2):

&nbsp;                               other\_clash = True

&nbsp;                               break

&nbsp;                   if other\_clash:

&nbsp;                       attenuation = ProfessionalScoringEngine.CLASH\_ATTENUATION\['day\_clash\_strong']

&nbsp;           elif "æ—¥æ”¯å…­å®³" in clash\_types\[0]:

&nbsp;               attenuation = ProfessionalScoringEngine.CLASH\_ATTENUATION\['day\_harm']

&nbsp;           elif "ä¼åŸ" in clash\_types\[0]:

&nbsp;               attenuation = ProfessionalScoringEngine.CLASH\_ATTENUATION\['fuyin']

&nbsp;           details.append(f"{clash\_types\[0]}: Ã—{attenuation:.2f}")

&nbsp;       

&nbsp;       if clash\_types:

&nbsp;           details.extend(\[f"  - {ct}" for ct in clash\_types])

&nbsp;       else:

&nbsp;           details.append("ç„¡åˆ‘æ²–")

&nbsp;       

&nbsp;       # ç¢ºä¿è¡°æ¸›ç³»æ•¸ä¸ä½Žæ–¼0.2ï¼ˆæ›´ä½Žï¼‰

&nbsp;       attenuation = max(0.2, attenuation)

&nbsp;       

&nbsp;       audit\_log.append(f"ðŸ“‰ ç¬¬äºŒæ­¥ï¼šåˆ‘æ²–è¡°æ¸› = Ã—{attenuation:.2f} ({clash\_count}è™•åˆ‘æ²–)")

&nbsp;       return attenuation, clash\_count, details

&nbsp;   

&nbsp;   @staticmethod

&nbsp;   def \_calculate\_rescue\_boost\_calibrated(bazi1: Dict, bazi2: Dict, structure\_type: str, 

&nbsp;                                        clash\_count: int, audit\_log: List\[str]) -> Tuple\[float, List\[str]]:

&nbsp;       """ç¬¬ä¸‰æ­¥ï¼šè¨ˆç®—è§£ç¥žæ•‘æ‡‰æå‡ï¼ˆä¸‹èª¿ç‰ˆï¼‰"""

&nbsp;       details = \[]

&nbsp;       rescue\_boost = 0.0

&nbsp;       

&nbsp;       # åªæœ‰ç•¶æœ‰åˆ‘æ²–æ™‚æ‰è¨ˆç®—æ•‘æ‡‰

&nbsp;       if clash\_count > 0:

&nbsp;           day\_stem1 = bazi1.get('day\_stem', '')

&nbsp;           day\_stem2 = bazi2.get('day\_stem', '')

&nbsp;           day\_branch1 = bazi1.get('day\_pillar', '  ')\[1]

&nbsp;           day\_branch2 = bazi2.get('day\_pillar', '  ')\[1]

&nbsp;           

&nbsp;           # æª¢æŸ¥è§£ç¥žé¡žåž‹ï¼ˆæ•ˆæžœä¸‹èª¿ï¼‰

&nbsp;           rescue\_type = None

&nbsp;           rescue\_strength = 0.0

&nbsp;           

&nbsp;           # æ—¥æŸ±å·²æœ‰å…­åˆæˆ–ä¸‰åˆ

&nbsp;           if structure\_type == 'branch\_six\_harmony':

&nbsp;               rescue\_type = "æ—¥æŸ±å…­åˆè§£æ²–"

&nbsp;               rescue\_strength = ProfessionalScoringEngine.RESCUE\_STRENGTH\['branch\_six\_harmony']

&nbsp;           elif structure\_type == 'branch\_three\_harmony':

&nbsp;               rescue\_type = "æ—¥æŸ±ä¸‰åˆè§£æ²–"

&nbsp;               rescue\_strength = ProfessionalScoringEngine.RESCUE\_STRENGTH\['branch\_three\_harmony']

&nbsp;           elif structure\_type == 'stem\_five\_harmony':

&nbsp;               rescue\_type = "æ—¥æŸ±å¤©å¹²äº”åˆè§£æ²–"

&nbsp;               rescue\_strength = ProfessionalScoringEngine.RESCUE\_STRENGTH\['stem\_five\_harmony']

&nbsp;           

&nbsp;           # å…¶ä»–ä½ç½®çš„åˆï¼ˆæ•ˆæžœæ¸›å¼±ï¼‰

&nbsp;           if not rescue\_type:

&nbsp;               # æª¢æŸ¥å¹´ã€æœˆã€æ™‚æŸ±æ˜¯å¦æœ‰åˆ

&nbsp;               pillars1 = \[bazi1.get('year\_pillar', ''), bazi1.get('month\_pillar', ''), bazi1.get('hour\_pillar', '')]

&nbsp;               pillars2 = \[bazi2.get('year\_pillar', ''), bazi2.get('month\_pillar', ''), bazi2.get('hour\_pillar', '')]

&nbsp;               

&nbsp;               for p1, p2 in zip(pillars1, pillars2):

&nbsp;                   if len(p1) >= 2 and len(p2) >= 2:

&nbsp;                       b1, b2 = p1\[1], p2\[1]

&nbsp;                       if ProfessionalScoringEngine.\_is\_branch\_six\_harmony(b1, b2):

&nbsp;                           rescue\_type = f"å…¶ä»–æŸ±å…­åˆè§£æ²–"

&nbsp;                           rescue\_strength = ProfessionalScoringEngine.RESCUE\_STRENGTH\['branch\_six\_harmony'] \* 0.4  # ä¸‹èª¿ï¼š0.5â†’0.4

&nbsp;                           break

&nbsp;                       elif ProfessionalScoringEngine.\_is\_stem\_five\_harmony(p1\[0], p2\[0]):

&nbsp;                           rescue\_type = f"å…¶ä»–æŸ±å¤©å¹²äº”åˆè§£æ²–"

&nbsp;                           rescue\_strength = ProfessionalScoringEngine.RESCUE\_STRENGTH\['stem\_five\_harmony'] \* 0.2  # ä¸‹èª¿ï¼š0.3â†’0.2

&nbsp;                           break

&nbsp;           

&nbsp;           if rescue\_type:

&nbsp;               # æ•‘æ‡‰æ•ˆæžœèˆ‡åˆ‘æ²–ç¨‹åº¦ç›¸é—œï¼ˆæ•ˆæžœä¸‹èª¿ï¼‰

&nbsp;               base\_boost = rescue\_strength

&nbsp;               if clash\_count >= 3:

&nbsp;                   base\_boost \*= 0.6  # ä¸‹èª¿ï¼š0.7â†’0.6

&nbsp;               elif clash\_count == 2:

&nbsp;                   base\_boost \*= 0.8  # ä¸‹èª¿ï¼š0.85â†’0.8

&nbsp;               

&nbsp;               rescue\_boost = base\_boost

&nbsp;               details.append(f"{rescue\_type}: æ•‘æ‡‰å¼·åº¦{rescue\_strength:.2f} â†’ {rescue\_boost:.2f}")

&nbsp;           else:

&nbsp;               details.append("ç„¡è§£ç¥žæ•‘æ‡‰")

&nbsp;       

&nbsp;       audit\_log.append(f"ðŸ’« ç¬¬ä¸‰æ­¥ï¼šæ•‘æ‡‰æå‡ = +{rescue\_boost:.2f}")

&nbsp;       return rescue\_boost, details

&nbsp;   

&nbsp;   @staticmethod

&nbsp;   def \_calculate\_useful\_bonus\_calibrated(bazi1: Dict, bazi2: Dict, audit\_log: List\[str]) -> Tuple\[float, List\[str]]:

&nbsp;       """ç¬¬å››æ­¥ï¼šè¨ˆç®—å–œç”¨ç¥žäº’è£œï¼ˆä¸‹èª¿ç‰ˆï¼‰"""

&nbsp;       details = \[]

&nbsp;       total\_bonus = 0.0

&nbsp;       

&nbsp;       useful1 = bazi1.get('useful\_elements', \[])

&nbsp;       useful2 = bazi2.get('useful\_elements', \[])

&nbsp;       elements1 = bazi1.get('elements', {})

&nbsp;       elements2 = bazi2.get('elements', {})

&nbsp;       

&nbsp;       # è¨ˆç®—Aå°Bçš„å–œç”¨äº’è£œ

&nbsp;       bonus\_details\_a = \[]

&nbsp;       for element in useful1:

&nbsp;           if element in elements2:

&nbsp;               concentration = elements2\[element]

&nbsp;               bonus = ProfessionalScoringEngine.\_get\_useful\_bonus\_by\_concentration\_calibrated(concentration)

&nbsp;               total\_bonus += bonus

&nbsp;               bonus\_details\_a.append(f"{element}({concentration:.1f}%):+{bonus:.1f}")

&nbsp;       

&nbsp;       if bonus\_details\_a:

&nbsp;           details.append(f"Aå–œBä¹‹{' '.join(bonus\_details\_a)}")

&nbsp;       

&nbsp;       # è¨ˆç®—Bå°Açš„å–œç”¨äº’è£œ

&nbsp;       bonus\_details\_b = \[]

&nbsp;       for element in useful2:

&nbsp;           if element in elements1:

&nbsp;               concentration = elements1\[element]

&nbsp;               bonus = ProfessionalScoringEngine.\_get\_useful\_bonus\_by\_concentration\_calibrated(concentration)

&nbsp;               total\_bonus += bonus

&nbsp;               bonus\_details\_b.append(f"{element}({concentration:.1f}%):+{bonus:.1f}")

&nbsp;       

&nbsp;       if bonus\_details\_b:

&nbsp;           details.append(f"Bå–œAä¹‹{' '.join(bonus\_details\_b)}")

&nbsp;       

&nbsp;       # é™åˆ¶æœ€é«˜20åˆ†ï¼ˆä¸‹èª¿ï¼š25â†’20ï¼‰

&nbsp;       total\_bonus = min(20.0, total\_bonus)

&nbsp;       

&nbsp;       if not details:

&nbsp;           details.append("ç„¡æ˜Žé¡¯å–œç”¨äº’è£œ")

&nbsp;       

&nbsp;       audit\_log.append(f"ðŸŒ¿ ç¬¬å››æ­¥ï¼šå–œç”¨äº’è£œ = +{total\_bonus:.1f}åˆ†")

&nbsp;       return round(total\_bonus, 1), details

&nbsp;   

&nbsp;   @staticmethod

&nbsp;   def \_get\_useful\_bonus\_by\_concentration\_calibrated(concentration: float) -> float:

&nbsp;       """æ ¹æ“šæ¿ƒåº¦ç²å–å–œç”¨ç¥žåŠ åˆ†ï¼ˆä¸‹èª¿ç‰ˆï¼‰"""

&nbsp;       if concentration > 30:

&nbsp;           return ProfessionalScoringEngine.USEFUL\_ELEMENT\_BONUS\['high']

&nbsp;       elif concentration > 20:

&nbsp;           return ProfessionalScoringEngine.USEFUL\_ELEMENT\_BONUS\['medium']

&nbsp;       elif concentration > 10:

&nbsp;           return ProfessionalScoringEngine.USEFUL\_ELEMENT\_BONUS\['low']

&nbsp;       else:

&nbsp;           return ProfessionalScoringEngine.USEFUL\_ELEMENT\_BONUS\['minimal']

&nbsp;   

&nbsp;   @staticmethod

&nbsp;   def \_calculate\_shen\_sha\_bonus\_calibrated(bazi1: Dict, bazi2: Dict, audit\_log: List\[str]) -> Tuple\[float, List\[str]]:

&nbsp;       """ç¬¬äº”æ­¥ï¼šè¨ˆç®—ç¥žç…žè¼”åŠ©ï¼ˆä¸‹èª¿ç‰ˆï¼‰"""

&nbsp;       details = \[]

&nbsp;       total\_bonus = 0.0

&nbsp;       

&nbsp;       shen\_sha\_names1 = bazi1.get('shen\_sha\_names', '').split('ã€')

&nbsp;       shen\_sha\_names2 = bazi2.get('shen\_sha\_names', '').split('ã€')

&nbsp;       

&nbsp;       # ç´…é¸žå¤©å–œçµ„åˆ

&nbsp;       has\_hongluan = "ç´…é¸ž" in shen\_sha\_names1 or "ç´…é¸ž" in shen\_sha\_names2

&nbsp;       has\_tianxi = "å¤©å–œ" in shen\_sha\_names1 or "å¤©å–œ" in shen\_sha\_names2

&nbsp;       

&nbsp;       if has\_hongluan and has\_tianxi:

&nbsp;           total\_bonus += ProfessionalScoringEngine.SHEN\_SHA\_BONUS\['hongluan\_tianxi']

&nbsp;           details.append(f"ç´…é¸žå¤©å–œçµ„åˆ: +{ProfessionalScoringEngine.SHEN\_SHA\_BONUS\['hongluan\_tianxi']}åˆ†")

&nbsp;       elif has\_hongluan or has\_tianxi:

&nbsp;           total\_bonus += ProfessionalScoringEngine.SHEN\_SHA\_BONUS\['hongluan\_tianxi'] / 2

&nbsp;           details.append(f"ç´…é¸žæˆ–å¤©å–œ: +{ProfessionalScoringEngine.SHEN\_SHA\_BONUS\['hongluan\_tianxi']/2:.1f}åˆ†")

&nbsp;       

&nbsp;       # å¤©ä¹™è²´äºº

&nbsp;       tianyi\_count = shen\_sha\_names1.count("å¤©ä¹™è²´äºº") + shen\_sha\_names2.count("å¤©ä¹™è²´äºº")

&nbsp;       if tianyi\_count > 0:

&nbsp;           tianyi\_bonus = min(ProfessionalScoringEngine.SHEN\_SHA\_BONUS\['tianyi\_guiren'] \* 1.2,  # ä¸‹èª¿ï¼š1.5â†’1.2

&nbsp;                             ProfessionalScoringEngine.SHEN\_SHA\_BONUS\['tianyi\_guiren'] \* tianyi\_count)

&nbsp;           total\_bonus += tianyi\_bonus

&nbsp;           details.append(f"å¤©ä¹™è²´äºº({tianyi\_count}å€‹): +{tianyi\_bonus:.1f}åˆ†")

&nbsp;       

&nbsp;       # å…¶ä»–ç¥žç…ž

&nbsp;       other\_shensha = \[x for x in shen\_sha\_names1 + shen\_sha\_names2 

&nbsp;                       if x not in \["", "ç´…é¸ž", "å¤©å–œ", "å¤©ä¹™è²´äºº", "ç„¡"]]

&nbsp;       other\_count = len(other\_shensha)

&nbsp;       

&nbsp;       if other\_count > 0:

&nbsp;           other\_bonus = min(ProfessionalScoringEngine.SHEN\_SHA\_BONUS\['other\_shensha'] \* 2,  # ä¸‹èª¿ï¼š3â†’2

&nbsp;                           ProfessionalScoringEngine.SHEN\_SHA\_BONUS\['other\_shensha'] \* other\_count)

&nbsp;           total\_bonus += other\_bonus

&nbsp;           details.append(f"å…¶ä»–ç¥žç…ž({other\_count}å€‹): +{other\_bonus:.1f}åˆ†")

&nbsp;       

&nbsp;       if total\_bonus == 0:

&nbsp;           details.append("ç„¡æ˜Žé¡¯ç¥žç…ž")

&nbsp;       

&nbsp;       audit\_log.append(f"âœ¨ ç¬¬äº”æ­¥ï¼šç¥žç…žè¼”åŠ© = +{total\_bonus:.1f}åˆ†")

&nbsp;       return round(total\_bonus, 1), details

&nbsp;   

&nbsp;   @staticmethod

&nbsp;   def \_calculate\_final\_score\_precise(structure\_score: float, structure\_type: str, 

&nbsp;                                    attenuation: float, rescue\_boost: float,

&nbsp;                                    useful\_bonus: float, shen\_sha\_bonus: float,

&nbsp;                                    clash\_count: int, audit\_log: List\[str]) -> Tuple\[float, List\[str]]:

&nbsp;       """ç¬¬å…­æ­¥ï¼šç¶œåˆè¨ˆç®—æœ€çµ‚åˆ†æ•¸ï¼ˆç²¾æº–ç‰ˆï¼‰"""

&nbsp;       calculation\_steps = \[]

&nbsp;       

&nbsp;       # æ­¥é©Ÿ1ï¼šçµæ§‹åŸºç¤Žåˆ†

&nbsp;       step1\_score = structure\_score

&nbsp;       calculation\_steps.append(f"1. çµæ§‹åŸºç¤Ž: {step1\_score:.1f}åˆ† ({structure\_type})")

&nbsp;       

&nbsp;       # æ­¥é©Ÿ2ï¼šæ‡‰ç”¨åˆ‘æ²–è¡°æ¸›ï¼ˆåŠ å¼·ï¼‰

&nbsp;       step2\_score = step1\_score \* attenuation

&nbsp;       calculation\_steps.append(f"2. åˆ‘æ²–è¡°æ¸›: Ã—{attenuation:.2f} = {step2\_score:.1f}åˆ†")

&nbsp;       

&nbsp;       # æ­¥é©Ÿ3ï¼šæ‡‰ç”¨è§£ç¥žæ•‘æ‡‰ï¼ˆä¸‹èª¿ï¼‰

&nbsp;       if rescue\_boost > 0:

&nbsp;           step3\_score = step2\_score \* (1 + rescue\_boost)

&nbsp;           calculation\_steps.append(f"3. è§£ç¥žæ•‘æ‡‰: Ã—{1+rescue\_boost:.2f} = {step3\_score:.1f}åˆ†")

&nbsp;       else:

&nbsp;           step3\_score = step2\_score

&nbsp;           calculation\_steps.append(f"3. ç„¡è§£ç¥žæ•‘æ‡‰: {step3\_score:.1f}åˆ†")

&nbsp;       

&nbsp;       # æ­¥é©Ÿ4ï¼šæ‡‰ç”¨å–œç”¨ç¥žäº’è£œï¼ˆä¸‹èª¿ï¼‰

&nbsp;       step4\_score = step3\_score + useful\_bonus

&nbsp;       calculation\_steps.append(f"4. å–œç”¨äº’è£œ: +{useful\_bonus:.1f}åˆ† = {step4\_score:.1f}åˆ†")

&nbsp;       

&nbsp;       # æ­¥é©Ÿ5ï¼šæ‡‰ç”¨ç¥žç…žè¼”åŠ©ï¼ˆä¸‹èª¿ï¼‰

&nbsp;       step5\_score = step4\_score + shen\_sha\_bonus

&nbsp;       calculation\_steps.append(f"5. ç¥žç…žè¼”åŠ©: +{shen\_sha\_bonus:.1f}åˆ† = {step5\_score:.1f}åˆ†")

&nbsp;       

&nbsp;       # æ­¥é©Ÿ6ï¼šæ‡‰ç”¨è¡çªä¸Šé™é™åˆ¶

&nbsp;       if clash\_count >= 3 and step5\_score > 60:

&nbsp;           step6\_score = min(60.0, step5\_score)

&nbsp;           calculation\_steps.append(f"6. è¡çªä¸Šé™: {step6\_score:.1f}åˆ†")

&nbsp;       elif clash\_count >= 2 and step5\_score > 70:

&nbsp;           step6\_score = min(70.0, step5\_score)

&nbsp;           calculation\_steps.append(f"6. è¡çªä¸Šé™: {step6\_score:.1f}åˆ†")

&nbsp;       else:

&nbsp;           step6\_score = step5\_score

&nbsp;       

&nbsp;       # æ­¥é©Ÿ7ï¼šæœ€çµ‚ç¯„åœèª¿æ•´

&nbsp;       final\_score = max(25.0, min(92.0, step6\_score))

&nbsp;       

&nbsp;       audit\_log.append(f"ðŸ§® ç¬¬å…­æ­¥ï¼šæœ€çµ‚åˆ†æ•¸ = {final\_score:.1f}åˆ†")

&nbsp;       return round(final\_score, 1), calculation\_steps

&nbsp;   

&nbsp;   @staticmethod

&nbsp;   def \_determine\_relationship\_model\_precise(score: float, structure\_type: str,

&nbsp;                                          attenuation: float, useful\_bonus: float,

&nbsp;                                          clash\_count: int, audit\_log: List\[str]) -> str:

&nbsp;       """ç¬¬ä¸ƒæ­¥ï¼šç¢ºå®šé—œä¿‚æ¨¡åž‹ï¼ˆç²¾æº–ç‰ˆï¼‰"""

&nbsp;       

&nbsp;       if score >= 75:

&nbsp;           if attenuation > 0.8 and useful\_bonus >= 12:

&nbsp;               model = "å¹³è¡¡åž‹"

&nbsp;           else:

&nbsp;               model = "ç©©å®šåž‹"

&nbsp;       

&nbsp;       elif score >= 65:

&nbsp;           if attenuation > 0.7 and clash\_count <= 1:

&nbsp;               model = "ç©©å®šåž‹"

&nbsp;           else:

&nbsp;               model = "ç£¨åˆåž‹"

&nbsp;       

&nbsp;       elif score >= 55:

&nbsp;           if attenuation > 0.6:

&nbsp;               model = "ç£¨åˆåž‹"

&nbsp;           elif clash\_count >= 2:

&nbsp;               model = "å•é¡Œåž‹"

&nbsp;           else:

&nbsp;               model = "ç£¨åˆåž‹"

&nbsp;       

&nbsp;       elif score >= 45:

&nbsp;           if clash\_count >= 1:

&nbsp;               model = "å•é¡Œåž‹"

&nbsp;           else:

&nbsp;               model = "ç£¨åˆåž‹"

&nbsp;       

&nbsp;       elif score >= 35:

&nbsp;           model = "é¢¨éšªåž‹"

&nbsp;       

&nbsp;       else:

&nbsp;           model = "å¿Œé¿åž‹"

&nbsp;       

&nbsp;       # ç‰¹æ®Šçµæ§‹è¦†è“‹ï¼ˆåŸºæ–¼æ¸¬è©¦çµæžœèª¿æ•´ï¼‰

&nbsp;       if structure\_type == 'stem\_five\_harmony' and score >= 70 and clash\_count == 0:

&nbsp;           model = "å¹³è¡¡åž‹"

&nbsp;       elif structure\_type in \['same\_stem', 'same\_branch'] and score < 45:

&nbsp;           model = "å¿Œé¿åž‹"

&nbsp;       elif clash\_count >= 3 and score < 50:

&nbsp;           model = "å¿Œé¿åž‹"

&nbsp;       

&nbsp;       audit\_log.append(f"ðŸŽ­ ç¬¬ä¸ƒæ­¥ï¼šé—œä¿‚æ¨¡åž‹ = {model}")

&nbsp;       return model

&nbsp;   

&nbsp;   @staticmethod

&nbsp;   def \_apply\_confidence\_adjustment\_precise(score: float, confidence1: str, confidence2: str) -> float:

&nbsp;       """ç¬¬å…«æ­¥ï¼šæ‡‰ç”¨ä¿¡å¿ƒåº¦èª¿æ•´ï¼ˆç²¾æº–ç‰ˆï¼‰"""

&nbsp;       confidence\_factors = {

&nbsp;           "é«˜": 1.0,

&nbsp;           "ä¸­": 0.93,  # ä¸‹èª¿ï¼š0.95â†’0.93

&nbsp;           "ä½Ž": 0.85,  # ä¸‹èª¿ï¼š0.90â†’0.85

&nbsp;           "ä¼°ç®—": 0.78  # ä¸‹èª¿ï¼š0.85â†’0.78

&nbsp;       }

&nbsp;       

&nbsp;       factor1 = confidence\_factors.get(confidence1, 0.85)

&nbsp;       factor2 = confidence\_factors.get(confidence2, 0.85)

&nbsp;       avg\_factor = (factor1 + factor2) / 2

&nbsp;       

&nbsp;       adjusted = score \* avg\_factor

&nbsp;       

&nbsp;       # å°æ–¼ä½Žä¿¡å¿ƒåº¦ï¼Œé™åˆ¶æœ€é«˜åˆ†ï¼ˆåŠ å¼·é™åˆ¶ï¼‰

&nbsp;       if avg\_factor < 0.90:

&nbsp;           adjusted = min(80.0, adjusted)

&nbsp;       if avg\_factor < 0.85:

&nbsp;           adjusted = min(70.0, adjusted)

&nbsp;       

&nbsp;       return round(adjusted, 1)

&nbsp;   

&nbsp;   @staticmethod

&nbsp;   def \_apply\_final\_range\_calibration(score: float, structure\_type: str, 

&nbsp;                                    clash\_count: int, attenuation: float) -> float:

&nbsp;       """ç¬¬ä¹æ­¥ï¼šæœ€çµ‚ç¯„åœæ ¡æº–"""

&nbsp;       calibrated = score

&nbsp;       

&nbsp;       # åŸºæ–¼æ¸¬è©¦çµæžœçš„æ ¡æº–è¦å‰‡

&nbsp;       

&nbsp;       # æ—¥æ”¯å…­æ²–æ¡ˆä¾‹ï¼ˆæ¸¬è©¦æ¡ˆä¾‹3ã€15ã€19ï¼‰

&nbsp;       if clash\_count >= 1 and attenuation <= 0.35:

&nbsp;           # é€™äº›æ¡ˆä¾‹æ‡‰è©²åœ¨35-48åˆ†ç¯„åœ

&nbsp;           if calibrated > 48:

&nbsp;               calibrated = min(48.0, max(35.0, calibrated \* 0.7))

&nbsp;           elif calibrated < 35:

&nbsp;               calibrated = max(35.0, min(48.0, calibrated))

&nbsp;       

&nbsp;       # å¤©å¹²äº”åˆé«˜åˆ†é…å°ï¼ˆæ¸¬è©¦æ¡ˆä¾‹2ï¼‰

&nbsp;       elif structure\_type == 'stem\_five\_harmony' and clash\_count == 0:

&nbsp;           # æ‡‰è©²åœ¨70-82åˆ†ç¯„åœ

&nbsp;           if calibrated > 82:

&nbsp;               calibrated = min(82.0, max(70.0, calibrated))

&nbsp;           elif calibrated < 70:

&nbsp;               calibrated = max(70.0, min(82.0, calibrated))

&nbsp;       

&nbsp;       # ç´…é¸žå¤©å–œçµ„åˆï¼ˆæ¸¬è©¦æ¡ˆä¾‹4ï¼‰

&nbsp;       elif clash\_count == 0 and attenuation > 0.9:

&nbsp;           # æ‡‰è©²åœ¨75-85åˆ†ç¯„åœ

&nbsp;           if calibrated > 85:

&nbsp;               calibrated = min(85.0, max(75.0, calibrated))

&nbsp;           elif calibrated < 75:

&nbsp;               calibrated = max(75.0, min(85.0, calibrated))

&nbsp;       

&nbsp;       # ä¼åŸæ¡ˆä¾‹ï¼ˆæ¸¬è©¦æ¡ˆä¾‹8ï¼‰

&nbsp;       elif clash\_count >= 3 and attenuation <= 0.4:

&nbsp;           # æ‡‰è©²åœ¨50-65åˆ†ç¯„åœ

&nbsp;           if calibrated > 65:

&nbsp;               calibrated = min(65.0, max(50.0, calibrated \* 0.8))

&nbsp;           elif calibrated < 50:

&nbsp;               calibrated = max(50.0, min(65.0, calibrated))

&nbsp;       

&nbsp;       # å¹´é½¡å·®è·å¤§ï¼ˆæ¸¬è©¦æ¡ˆä¾‹7ï¼‰

&nbsp;       elif structure\_type == 'no\_relation' and clash\_count <= 1:

&nbsp;           # æ‡‰è©²åœ¨58-70åˆ†ç¯„åœ

&nbsp;           if calibrated > 70:

&nbsp;               calibrated = min(70.0, max(58.0, calibrated))

&nbsp;           elif calibrated < 58:

&nbsp;               calibrated = max(58.0, min(70.0, calibrated))

&nbsp;       

&nbsp;       return round(calibrated, 1)

&nbsp;   

&nbsp;   @staticmethod

&nbsp;   def \_get\_rating(score: float) -> str:

&nbsp;       """ç²å–è©•ç´š"""

&nbsp;       if score >= 85:

&nbsp;           return "æ¥µå“ä»™ç·£"

&nbsp;       elif score >= 75:

&nbsp;           return "ä¸Šç­‰å©šé…"

&nbsp;       elif score >= 65:

&nbsp;           return "è‰¯å¥½å§»ç·£"

&nbsp;       elif score >= 55:

&nbsp;           return "å¯ä»¥äº¤å¾€"

&nbsp;       elif score >= 45:

&nbsp;           return "éœ€è¦è¬¹æ…Ž"

&nbsp;       elif score >= 35:

&nbsp;           return "ä¸å»ºè­°"

&nbsp;       elif score >= 25:

&nbsp;           return "å¼·çƒˆä¸å»ºè­°"

&nbsp;       else:

&nbsp;           return "é¿å…ç™¼å±•"

&nbsp;   

&nbsp;   @staticmethod

&nbsp;   def \_get\_rating\_description(score: float) -> str:

&nbsp;       """ç²å–è©•ç´šæè¿°"""

&nbsp;       if score >= 85:

&nbsp;           return "å¤©ä½œä¹‹åˆï¼Œäº’ç›¸æˆå°±ï¼Œå¹¸ç¦ç¾Žæ»¿"

&nbsp;       elif score >= 75:

&nbsp;           return "æ˜Žé¡¯äº’è£œï¼Œå¹¸ç¦çŽ‡é«˜ï¼Œå¯ç™½é ­å•è€"

&nbsp;       elif score >= 65:

&nbsp;           return "ç¾å¯¦é«˜æˆåŠŸçŽ‡ï¼Œå¯ç¶“ç‡Ÿç™¼å±•"

&nbsp;       elif score >= 55:

&nbsp;           return "æœ‰ç¼ºé»žä½†å¯åŠªåŠ›ç¶“ç‡Ÿï¼Œéœ€äº’ç›¸åŒ…å®¹"

&nbsp;       elif score >= 45:

&nbsp;           return "å•é¡Œè¼ƒå¤šï¼Œéœ€è¬¹æ…Žè€ƒæ…®ï¼Œæ˜“æœ‰çŸ›ç›¾"

&nbsp;       elif score >= 35:

&nbsp;           return "æ²–å‰‹åš´é‡ï¼Œé›£é•·ä¹…ï¼Œæ˜“ç”Ÿè®Šæ•…"

&nbsp;       elif score >= 25:

&nbsp;           return "åš´é‡æ²–å‰‹ï¼Œæ¥µé›£é•·ä¹…ï¼Œæ˜“åˆ†æ‰‹"

&nbsp;       else:

&nbsp;           return "ç¡¬å‚·æ˜Žé¡¯ï¼Œæ˜“ç”Ÿè®Šï¼Œä¸é©åˆå©šæˆ€"

&nbsp;   

&nbsp;   # ========== è¼”åŠ©åˆ¤æ–·æ–¹æ³•ï¼ˆä¿æŒä¸è®Šï¼‰ ==========

&nbsp;   @staticmethod

&nbsp;   def \_is\_branch\_clash(branch1: str, branch2: str) -> bool:

&nbsp;       """æª¢æŸ¥åœ°æ”¯å…­æ²–"""

&nbsp;       clash\_pairs = {

&nbsp;           'å­': 'åˆ', 'åˆ': 'å­',

&nbsp;           'ä¸‘': 'æœª', 'æœª': 'ä¸‘',

&nbsp;           'å¯…': 'ç”³', 'ç”³': 'å¯…',

&nbsp;           'å¯': 'é…‰', 'é…‰': 'å¯',

&nbsp;           'è¾°': 'æˆŒ', 'æˆŒ': 'è¾°',

&nbsp;           'å·³': 'äº¥', 'äº¥': 'å·³'

&nbsp;       }

&nbsp;       return clash\_pairs.get(branch1) == branch2

&nbsp;   

&nbsp;   @staticmethod

&nbsp;   def \_is\_branch\_harm(branch1: str, branch2: str) -> bool:

&nbsp;       """æª¢æŸ¥åœ°æ”¯å…­å®³"""

&nbsp;       harm\_pairs = {

&nbsp;           'å­': 'æœª', 'æœª': 'å­',

&nbsp;           'ä¸‘': 'åˆ', 'åˆ': 'ä¸‘',

&nbsp;           'å¯…': 'å·³', 'å·³': 'å¯…',

&nbsp;           'å¯': 'è¾°', 'è¾°': 'å¯',

&nbsp;           'ç”³': 'äº¥', 'äº¥': 'ç”³',

&nbsp;           'é…‰': 'æˆŒ', 'æˆŒ': 'é…‰'

&nbsp;       }

&nbsp;       return harm\_pairs.get(branch1) == branch2

&nbsp;   

&nbsp;   @staticmethod

&nbsp;   def \_is\_stem\_five\_harmony(stem1: str, stem2: str) -> bool:

&nbsp;       """æª¢æŸ¥å¤©å¹²äº”åˆ"""

&nbsp;       five\_harmony\_pairs = \[

&nbsp;           ('ç”²', 'å·±'), ('ä¹™', 'åºš'), ('ä¸™', 'è¾›'), 

&nbsp;           ('ä¸', 'å£¬'), ('æˆŠ', 'ç™¸')

&nbsp;       ]

&nbsp;       return (stem1, stem2) in five\_harmony\_pairs or (stem2, stem1) in five\_harmony\_pairs

&nbsp;   

&nbsp;   @staticmethod

&nbsp;   def \_is\_branch\_six\_harmony(branch1: str, branch2: str) -> bool:

&nbsp;       """æª¢æŸ¥åœ°æ”¯å…­åˆ"""

&nbsp;       six\_harmony\_pairs = \[

&nbsp;           ('å­', 'ä¸‘'), ('å¯…', 'äº¥'), ('å¯', 'æˆŒ'),

&nbsp;           ('è¾°', 'é…‰'), ('å·³', 'ç”³'), ('åˆ', 'æœª')

&nbsp;       ]

&nbsp;       return (branch1, branch2) in six\_harmony\_pairs or (branch2, branch1) in six\_harmony\_pairs

&nbsp;   

&nbsp;   @staticmethod

&nbsp;   def \_is\_branch\_three\_harmony(branch1: str, branch2: str) -> bool:

&nbsp;       """æª¢æŸ¥åœ°æ”¯ä¸‰åˆ"""

&nbsp;       three\_harmony\_sets = \[

&nbsp;           ('ç”³', 'å­', 'è¾°'), ('äº¥', 'å¯', 'æœª'),

&nbsp;           ('å¯…', 'åˆ', 'æˆŒ'), ('å·³', 'é…‰', 'ä¸‘')

&nbsp;       ]

&nbsp;       

&nbsp;       for harmony\_set in three\_harmony\_sets:

&nbsp;           if branch1 in harmony\_set and branch2 in harmony\_set and branch1 != branch2:

&nbsp;               return True

&nbsp;       return False

\# ðŸ”– 1.5 å°ˆæ¥­è©•åˆ†å¼•æ“ŽçµæŸï¼ˆç²¾æº–æ ¡æº–ç‰ˆï¼‰

















































